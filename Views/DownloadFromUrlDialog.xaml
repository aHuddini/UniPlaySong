<UserControl x:Class="UniPlaySong.Views.DownloadFromUrlDialog"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d"
             d:DesignHeight="350" d:DesignWidth="550">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <materialDesign:BundledTheme BaseTheme="Dark" PrimaryColor="DeepPurple" SecondaryColor="Lime" />
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesignTheme.Defaults.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title -->
        <TextBlock Grid.Row="0"
                   Text="{Binding Title}"
                   Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                   Margin="0,0,0,8">
            <TextBlock.Foreground>
                <SolidColorBrush Color="White" Opacity="0.87"/>
            </TextBlock.Foreground>
        </TextBlock>

        <!-- Subtitle/Instructions -->
        <TextBlock Grid.Row="1"
                   Text="Paste a YouTube video URL to download the audio track."
                   FontSize="12"
                   Margin="0,0,0,16"
                   Opacity="0.7">
            <TextBlock.Foreground>
                <SolidColorBrush Color="White" Opacity="0.7"/>
            </TextBlock.Foreground>
        </TextBlock>

        <!-- URL Input -->
        <Grid Grid.Row="2" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBox Grid.Column="0"
                     materialDesign:HintAssist.Hint="YouTube URL (e.g., https://www.youtube.com/watch?v=...)"
                     Text="{Binding Url, UpdateSourceTrigger=PropertyChanged}"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                     FontSize="13"
                     Margin="0,0,8,0"
                     VerticalContentAlignment="Center"
                     MinHeight="40"
                     Name="UrlTextBox">
                <TextBox.Foreground>
                    <SolidColorBrush Color="White" Opacity="0.87"/>
                </TextBox.Foreground>
                <TextBox.InputBindings>
                    <KeyBinding Key="Enter" Command="{Binding ValidateUrlCommand}"/>
                </TextBox.InputBindings>
            </TextBox>
            <Button Grid.Column="1"
                    Content="VALIDATE"
                    Command="{Binding ValidateUrlCommand}"
                    FontSize="11"
                    Padding="12,6"
                    MinWidth="90"
                    MinHeight="40">
                <Button.Style>
                    <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignOutlinedButton}">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border"
                                            Background="#2196F3"
                                            BorderBrush="#2196F3"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="{TemplateBinding Padding}">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center">
                                            <ContentPresenter.Resources>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="White"/>
                                                </Style>
                                            </ContentPresenter.Resources>
                                        </ContentPresenter>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="#1976D2"/>
                                            <Setter TargetName="border" Property="BorderBrush" Value="#1976D2"/>
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="#1565C0"/>
                                            <Setter TargetName="border" Property="BorderBrush" Value="#1565C0"/>
                                        </Trigger>
                                        <Trigger Property="IsEnabled" Value="False">
                                            <Setter TargetName="border" Property="Background" Value="#555"/>
                                            <Setter TargetName="border" Property="BorderBrush" Value="#555"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Button.Style>
            </Button>
        </Grid>

        <!-- Validation Status -->
        <Border Grid.Row="3"
                Background="#1E1E1E"
                CornerRadius="4"
                Padding="12,8"
                Margin="0,0,0,12"
                Visibility="{Binding ShowValidationResult, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Status Icon -->
                <materialDesign:PackIcon Grid.Column="0"
                                         Kind="{Binding ValidationIcon}"
                                         Width="20"
                                         Height="20"
                                         Margin="0,0,8,0"
                                         VerticalAlignment="Center"
                                         Foreground="{Binding ValidationIconColor}"/>

                <!-- Video Info -->
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="{Binding VideoTitle}"
                               FontWeight="SemiBold"
                               FontSize="13"
                               TextTrimming="CharacterEllipsis">
                        <TextBlock.Foreground>
                            <SolidColorBrush Color="White" Opacity="0.87"/>
                        </TextBlock.Foreground>
                    </TextBlock>
                    <TextBlock Text="{Binding VideoInfo}"
                               FontSize="11"
                               Margin="0,2,0,0"
                               Opacity="0.7">
                        <TextBlock.Foreground>
                            <SolidColorBrush Color="White" Opacity="0.7"/>
                        </TextBlock.Foreground>
                    </TextBlock>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Preview Controls (shown after validation) -->
        <StackPanel Grid.Row="4"
                    Orientation="Horizontal"
                    Margin="0,0,0,12"
                    Visibility="{Binding IsValidUrl, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Button Command="{Binding PreviewCommand}"
                    ToolTip="Preview audio (30 seconds)"
                    Margin="0,0,8,0"
                    MinWidth="100"
                    MinHeight="36">
                <Button.Style>
                    <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignOutlinedButton}">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsPreviewPlaying}" Value="True">
                                <Setter Property="Content" Value="STOP"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding IsPreviewPlaying}" Value="False">
                                <Setter Property="Content" Value="PREVIEW"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </StackPanel>

        <!-- Progress Bar -->
        <Grid Grid.Row="5" Margin="0,0,0,12" Visibility="{Binding ShowProgress, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <TextBlock Grid.Row="0"
                      Text="{Binding ProgressText}"
                      HorizontalAlignment="Left"
                      FontSize="11"
                      Margin="0,0,0,4"
                      Opacity="0.87">
                <TextBlock.Foreground>
                    <SolidColorBrush Color="White" Opacity="0.87"/>
                </TextBlock.Foreground>
            </TextBlock>
            <ProgressBar Grid.Row="1"
                        IsIndeterminate="{Binding IsIndeterminate}"
                        Value="{Binding ProgressValue}"
                        Maximum="{Binding ProgressMax}"
                        Style="{StaticResource MaterialDesignLinearProgressBar}"
                        Height="4"/>
        </Grid>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="6" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="CANCEL"
                    Command="{Binding CancelCommand}"
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    FontSize="11"
                    Padding="12,6"
                    MinWidth="80"
                    Margin="0,0,8,0"
                    MinHeight="36"/>
            <Button Content="DOWNLOAD"
                    Command="{Binding DownloadCommand}"
                    FontSize="11"
                    Padding="12,6"
                    MinWidth="100"
                    MinHeight="36"
                    IsEnabled="{Binding IsValidUrl}">
                <Button.Style>
                    <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignRaisedButton}">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsDownloading}" Value="True">
                                <Setter Property="IsEnabled" Value="False"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </StackPanel>
    </Grid>
</UserControl>
