<UserControl x:Class="UniPlaySong.Views.AmplifyDialog"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="700"
             Background="#1e1e1e">

    <UserControl.Resources>
        <Style x:Key="AmplifyButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#3d3d3d"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#555"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#4d4d4d"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#2d2d2d"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="AccentButtonStyle" TargetType="Button" BasedOn="{StaticResource AmplifyButtonStyle}">
            <Setter Property="Background" Value="#0078d4"/>
            <Setter Property="BorderBrush" Value="#0078d4"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#1a8adb"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#006cbd"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header with file info -->
        <StackPanel Grid.Row="0" Margin="0,0,0,10">
            <TextBlock x:Name="FileNameText"
                       Text="Select a file to amplify"
                       FontSize="16"
                       FontWeight="SemiBold"
                       Foreground="White"/>
            <TextBlock x:Name="FileInfoText"
                       Text=""
                       FontSize="12"
                       Foreground="#888"
                       Margin="0,3,0,0"/>
        </StackPanel>

        <!-- File selection combo -->
        <Grid Grid.Row="1" Margin="0,0,0,15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <ComboBox x:Name="FileComboBox"
                      Grid.Column="0"
                      Height="32"
                      FontSize="13"
                      Background="#2d2d2d"
                      Foreground="White"
                      BorderBrush="#555"
                      SelectionChanged="FileComboBox_SelectionChanged"/>

            <Button x:Name="RefreshButton"
                    Grid.Column="1"
                    Content="Refresh"
                    Style="{StaticResource AmplifyButtonStyle}"
                    Margin="10,0,0,0"
                    Click="RefreshButton_Click"/>
        </Grid>

        <!-- Waveform display area -->
        <Border Grid.Row="2"
                Background="#0a0a0a"
                BorderBrush="#333"
                BorderThickness="1"
                CornerRadius="4"
                Margin="0,0,0,10">

            <Grid>
                <!-- Loading overlay -->
                <Border x:Name="LoadingOverlay"
                        Background="#80000000"
                        Visibility="Collapsed"
                        Panel.ZIndex="10">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <TextBlock Text="Loading waveform..."
                                   Foreground="White"
                                   FontSize="14"
                                   HorizontalAlignment="Center"/>
                        <ProgressBar IsIndeterminate="True"
                                     Width="200"
                                     Height="4"
                                     Margin="0,10,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Waveform canvas -->
                <Canvas x:Name="WaveformCanvas"
                        ClipToBounds="True"
                        Background="Transparent"
                        MouseLeftButtonDown="WaveformCanvas_MouseLeftButtonDown"
                        MouseLeftButtonUp="WaveformCanvas_MouseLeftButtonUp"
                        MouseMove="WaveformCanvas_MouseMove"
                        MouseLeave="WaveformCanvas_MouseLeave"
                        SizeChanged="WaveformCanvas_SizeChanged">

                    <!-- 0dB reference line (center) -->
                    <Line x:Name="CenterLine"
                          Stroke="#444"
                          StrokeThickness="1"
                          StrokeDashArray="4,2"/>

                    <!-- Clipping region overlay (areas that would exceed 0dBFS) -->
                    <Polygon x:Name="ClippingRegion"
                             Fill="#40FF0000"
                             Stroke="#FF0000"
                             StrokeThickness="1"
                             Visibility="Collapsed"/>

                    <!-- Original waveform polyline (ghost/reference) -->
                    <Polyline x:Name="OriginalWaveformLine"
                              Stroke="#333"
                              StrokeThickness="1"/>

                    <!-- Scaled waveform polyline (shows amplified result) -->
                    <Polyline x:Name="ScaledWaveformLine"
                              Stroke="#32CD32"
                              StrokeThickness="1"/>

                    <!-- Gain adjustment line (horizontal, user drags up/down) -->
                    <Line x:Name="GainLine"
                          Stroke="#FFD700"
                          StrokeThickness="3"
                          Cursor="SizeNS"/>

                    <!-- Gain line handles (left/right ends) -->
                    <Ellipse x:Name="GainHandleLeft"
                             Width="12" Height="12"
                             Fill="#FFD700"
                             Stroke="#FFA500"
                             StrokeThickness="2"
                             Cursor="SizeNS"/>
                    <Ellipse x:Name="GainHandleRight"
                             Width="12" Height="12"
                             Fill="#FFD700"
                             Stroke="#FFA500"
                             StrokeThickness="2"
                             Cursor="SizeNS"/>

                    <!-- Headroom indicator line (max safe gain) -->
                    <Line x:Name="HeadroomLine"
                          Stroke="#4CAF50"
                          StrokeThickness="1"
                          StrokeDashArray="2,2"
                          Visibility="Collapsed"/>
                </Canvas>

                <!-- dB scale on right side -->
                <StackPanel x:Name="DbScale"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Stretch"
                            Margin="0,10,5,10"
                            Width="40">
                    <TextBlock Text="+12dB" Foreground="#888" FontSize="10" HorizontalAlignment="Right"/>
                    <TextBlock Text="+6dB" Foreground="#888" FontSize="10" HorizontalAlignment="Right" Margin="0,20,0,0"/>
                    <TextBlock Text="0dB" Foreground="#4CAF50" FontSize="10" FontWeight="Bold" HorizontalAlignment="Right" Margin="0,20,0,0"/>
                    <TextBlock Text="-6dB" Foreground="#888" FontSize="10" HorizontalAlignment="Right" Margin="0,20,0,0"/>
                    <TextBlock Text="-12dB" Foreground="#888" FontSize="10" HorizontalAlignment="Right" Margin="0,20,0,0"/>
                </StackPanel>

                <!-- No waveform message -->
                <TextBlock x:Name="NoWaveformText"
                           Text="No audio file selected"
                           Foreground="#666"
                           FontSize="14"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Visibility="Visible"/>
            </Grid>
        </Border>

        <!-- Gain display and controls -->
        <Grid Grid.Row="3" Margin="0,0,0,15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Peak info -->
            <StackPanel Grid.Column="0" Orientation="Horizontal">
                <TextBlock Text="Peak: " Foreground="#888" FontSize="13" VerticalAlignment="Center"/>
                <TextBlock x:Name="PeakText" Text="-0.0 dB" Foreground="#4CAF50" FontSize="13" FontWeight="SemiBold" VerticalAlignment="Center"/>
                <TextBlock Text=" | Headroom: " Foreground="#888" FontSize="13" VerticalAlignment="Center" Margin="10,0,0,0"/>
                <TextBlock x:Name="HeadroomText" Text="+0.0 dB" Foreground="#4CAF50" FontSize="13" FontWeight="SemiBold" VerticalAlignment="Center"/>
            </StackPanel>

            <!-- Current gain -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                <TextBlock Text="Gain: " Foreground="#888" FontSize="16" VerticalAlignment="Center"/>
                <TextBlock x:Name="GainText" Text="+0.0 dB" Foreground="#FFD700" FontSize="16" FontWeight="Bold" VerticalAlignment="Center"/>
            </StackPanel>

            <!-- Clipping warning -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                <TextBlock x:Name="ClippingWarning"
                           Text="CLIPPING!"
                           Foreground="#FF4444"
                           FontSize="13"
                           FontWeight="Bold"
                           VerticalAlignment="Center"
                           Visibility="Collapsed"/>
            </StackPanel>
        </Grid>

        <!-- Action buttons -->
        <Grid Grid.Row="4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button x:Name="ResetButton"
                    Grid.Column="0"
                    Content="Reset (0 dB)"
                    Style="{StaticResource AmplifyButtonStyle}"
                    Click="ResetButton_Click"
                    ToolTip="Reset gain to 0 dB"/>

            <Button x:Name="PreviewButton"
                    Grid.Column="2"
                    Content="Preview"
                    Style="{StaticResource AmplifyButtonStyle}"
                    Margin="0,0,10,0"
                    Click="PreviewButton_Click"
                    ToolTip="Preview with current gain"/>

            <Button x:Name="ApplyButton"
                    Grid.Column="3"
                    Content="Apply"
                    Style="{StaticResource AccentButtonStyle}"
                    Margin="0,0,10,0"
                    Click="ApplyButton_Click"
                    ToolTip="Apply amplification and save"/>

            <Button x:Name="CancelButton"
                    Grid.Column="4"
                    Content="Cancel"
                    Style="{StaticResource AmplifyButtonStyle}"
                    Click="CancelButton_Click"/>
        </Grid>
    </Grid>
</UserControl>
