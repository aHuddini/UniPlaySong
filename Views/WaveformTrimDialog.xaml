<UserControl x:Class="UniPlaySong.Views.WaveformTrimDialog"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="700"
             Background="#1e1e1e">

    <UserControl.Resources>
        <Style x:Key="TrimButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#3d3d3d"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#555"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#4d4d4d"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#2d2d2d"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="AccentButtonStyle" TargetType="Button" BasedOn="{StaticResource TrimButtonStyle}">
            <Setter Property="Background" Value="#0078d4"/>
            <Setter Property="BorderBrush" Value="#0078d4"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#1a8adb"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#006cbd"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header with file info -->
        <StackPanel Grid.Row="0" Margin="0,0,0,10">
            <TextBlock x:Name="FileNameText"
                       Text="Select a file to trim"
                       FontSize="16"
                       FontWeight="SemiBold"
                       Foreground="White"/>
            <TextBlock x:Name="FileInfoText"
                       Text=""
                       FontSize="12"
                       Foreground="#888"
                       Margin="0,3,0,0"/>
        </StackPanel>

        <!-- File selection combo -->
        <Grid Grid.Row="1" Margin="0,0,0,15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <ComboBox x:Name="FileComboBox"
                      Grid.Column="0"
                      Height="32"
                      FontSize="13"
                      Background="#2d2d2d"
                      Foreground="White"
                      BorderBrush="#555"
                      SelectionChanged="FileComboBox_SelectionChanged"/>

            <Button x:Name="RefreshButton"
                    Grid.Column="1"
                    Content="Refresh"
                    Style="{StaticResource TrimButtonStyle}"
                    Margin="10,0,0,0"
                    Click="RefreshButton_Click"/>
        </Grid>

        <!-- Waveform display area -->
        <Border Grid.Row="2"
                Background="#0a0a0a"
                BorderBrush="#333"
                BorderThickness="1"
                CornerRadius="4"
                Margin="0,0,0,10">

            <Grid>
                <!-- Loading overlay -->
                <Border x:Name="LoadingOverlay"
                        Background="#80000000"
                        Visibility="Collapsed"
                        Panel.ZIndex="10">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <TextBlock Text="Loading waveform..."
                                   Foreground="White"
                                   FontSize="14"
                                   HorizontalAlignment="Center"/>
                        <ProgressBar IsIndeterminate="True"
                                     Width="200"
                                     Height="4"
                                     Margin="0,10,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Waveform canvas -->
                <Canvas x:Name="WaveformCanvas"
                        ClipToBounds="True"
                        Background="Transparent"
                        MouseLeftButtonDown="WaveformCanvas_MouseLeftButtonDown"
                        MouseLeftButtonUp="WaveformCanvas_MouseLeftButtonUp"
                        MouseMove="WaveformCanvas_MouseMove"
                        MouseLeave="WaveformCanvas_MouseLeave"
                        SizeChanged="WaveformCanvas_SizeChanged">

                    <!-- Center line -->
                    <Line x:Name="CenterLine"
                          Stroke="#333"
                          StrokeThickness="1"/>

                    <!-- Waveform polyline -->
                    <Polyline x:Name="WaveformLine"
                              Stroke="#32CD32"
                              StrokeThickness="1"/>

                    <!-- Excluded region (left of start) -->
                    <Rectangle x:Name="ExcludedLeft"
                               Fill="#80000000"/>

                    <!-- Excluded region (right of end) -->
                    <Rectangle x:Name="ExcludedRight"
                               Fill="#80000000"/>

                    <!-- Trim window (kept region) -->
                    <Rectangle x:Name="TrimWindowRect"
                               Fill="#1532CD32"
                               Stroke="#32CD32"
                               StrokeThickness="1"
                               Cursor="SizeAll"/>

                    <!-- Start marker -->
                    <Rectangle x:Name="StartMarker"
                               Width="6"
                               Fill="#4169E1"
                               Cursor="SizeWE"
                               MouseLeftButtonDown="StartMarker_MouseLeftButtonDown"/>

                    <!-- End marker -->
                    <Rectangle x:Name="EndMarker"
                               Width="6"
                               Fill="#DC143C"
                               Cursor="SizeWE"
                               MouseLeftButtonDown="EndMarker_MouseLeftButtonDown"/>

                    <!-- Playhead (during preview) -->
                    <Line x:Name="Playhead"
                          Stroke="Yellow"
                          StrokeThickness="2"
                          Visibility="Collapsed"/>
                </Canvas>

                <!-- No waveform message -->
                <TextBlock x:Name="NoWaveformText"
                           Text="No audio file selected"
                           Foreground="#666"
                           FontSize="14"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Visibility="Visible"/>
            </Grid>
        </Border>

        <!-- Time display and controls -->
        <Grid Grid.Row="3" Margin="0,0,0,15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Start time -->
            <StackPanel Grid.Column="0" Orientation="Horizontal">
                <TextBlock Text="Start: " Foreground="#888" FontSize="13" VerticalAlignment="Center"/>
                <TextBlock x:Name="StartTimeText" Text="00:00.000" Foreground="#4169E1" FontSize="13" FontWeight="SemiBold" VerticalAlignment="Center"/>
            </StackPanel>

            <!-- Duration -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                <TextBlock Text="Duration: " Foreground="#888" FontSize="13" VerticalAlignment="Center"/>
                <TextBlock x:Name="DurationText" Text="00:00.000" Foreground="#32CD32" FontSize="13" FontWeight="SemiBold" VerticalAlignment="Center"/>
                <TextBlock Text=" / " Foreground="#555" FontSize="13" VerticalAlignment="Center"/>
                <TextBlock x:Name="TotalDurationText" Text="00:00.000" Foreground="#555" FontSize="13" VerticalAlignment="Center"/>
            </StackPanel>

            <!-- End time -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                <TextBlock Text="End: " Foreground="#888" FontSize="13" VerticalAlignment="Center"/>
                <TextBlock x:Name="EndTimeText" Text="00:00.000" Foreground="#DC143C" FontSize="13" FontWeight="SemiBold" VerticalAlignment="Center"/>
            </StackPanel>
        </Grid>

        <!-- Action buttons -->
        <Grid Grid.Row="4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button x:Name="ResetButton"
                    Grid.Column="0"
                    Content="Reset"
                    Style="{StaticResource TrimButtonStyle}"
                    Click="ResetButton_Click"
                    ToolTip="Reset to full duration"/>

            <Button x:Name="PreviewButton"
                    Grid.Column="2"
                    Content="Preview"
                    Style="{StaticResource TrimButtonStyle}"
                    Margin="0,0,10,0"
                    Click="PreviewButton_Click"
                    ToolTip="Preview the kept portion"/>

            <Button x:Name="ApplyButton"
                    Grid.Column="3"
                    Content="Apply Trim"
                    Style="{StaticResource AccentButtonStyle}"
                    Margin="0,0,10,0"
                    Click="ApplyButton_Click"
                    ToolTip="Apply the trim and save"/>

            <Button x:Name="CancelButton"
                    Grid.Column="4"
                    Content="Cancel"
                    Style="{StaticResource TrimButtonStyle}"
                    Click="CancelButton_Click"/>
        </Grid>
    </Grid>
</UserControl>
