<UserControl x:Class="UniPlaySong.UniPlaySongSettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:UniPlaySong"
             mc:Ignorable="d"
             d:DesignHeight="500" d:DesignWidth="600">
    <UserControl.Resources>
        <local:AudioStateConverter x:Key="AudioStateConverter"/>
        <local:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
        <local:ReverbPresetConverter x:Key="ReverbPresetConverter"/>
        <local:StylePresetConverter x:Key="StylePresetConverter"/>
        <local:EffectChainPresetConverter x:Key="EffectChainPresetConverter"/>
        <local:HexToColorConverter x:Key="HexToColorConverter"/>
        <local:VizPresetConverter x:Key="VizPresetConverter"/>
        <local:VizColorThemeConverter x:Key="VizColorThemeConverter"/>
        <local:EnumToBooleanConverter x:Key="EnumToBooleanConverter"/>
    </UserControl.Resources>
    <TabControl>
        <!-- General Tab -->
        <TabItem Header="General">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel Margin="20">
                    <TextBlock Text="General Settings" FontSize="18" FontWeight="Bold" Margin="0,0,0,20"/>
                    
                    <CheckBox Content="Enable Music"
                              IsChecked="{Binding Settings.EnableMusic}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, music will automatically play when selecting games (console-like preview experience)"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <CheckBox Content="Suppress Playnite Native Background Music"
                              IsChecked="{Binding Settings.SuppressPlayniteBackgroundMusic}"
                              Margin="0,5"/>
                    <TextBlock Text="Default: Enabled. Prevents Playnite's built-in vanilla music from playing in the background during fullscreen mode, ensuring only UniPlaySong audio is heard."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,2"/>
                    <TextBlock Text="WARNING: Disabling this option will allow Playnite's vanilla theme music to play simultaneously alongside UniPlaySong music, causing annoying audio issues. This WILL negatively impact themes like ANIKI Remake and other fullscreen themes that include their own music. It is strongly recommended to keep this option enabled to ensure proper plugin functionality."
                               FontSize="11"
                               Foreground="#FFD44040"
                               FontWeight="SemiBold"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10">
                        <TextBlock Text="Play Music State: " VerticalAlignment="Center" Width="150"/>
                        <ComboBox SelectedIndex="{Binding Settings.MusicState, Converter={StaticResource AudioStateConverter}}" 
                                  Width="200" 
                                  Margin="0,0,0,0">
                            <ComboBoxItem Content="Never"/>
                            <ComboBoxItem Content="Desktop"/>
                            <ComboBoxItem Content="Fullscreen"/>
                            <ComboBoxItem Content="Desktop + Fullscreen"/>
                        </ComboBox>
                    </StackPanel>
                    <TextBlock Text="Controls when music plays: Never, Desktop only, Fullscreen only, or Both" 
                               FontSize="11" 
                               Foreground="Gray" 
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>
                    
                    <CheckBox Content="Do not play music on startup" 
                              IsChecked="{Binding Settings.SkipFirstSelectionAfterModeSwitch}" 
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, music will not play on the first game selection after switching to fullscreen mode" 
                               FontSize="11" 
                               Foreground="Gray" 
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>
                    
                    <CheckBox Content="Theme Compatible Login Skip"
                              IsChecked="{Binding Settings.ThemeCompatibleSilentSkip}"
                              IsEnabled="{Binding Settings.IsThemeCompatibleSilentSkipEnabled}"
                              Margin="0,5"/>
                    <TextBlock Text="Waits for keyboard or controller input (Enter/Space/Escape/Return) before playing music. When enabled, music will not play until you press a key to dismiss the login screen. Useful for fullscreen themes with login/welcome screens."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <CheckBox Content="Pause music when Playnite loses focus"
                              IsChecked="{Binding Settings.PauseOnFocusLoss}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, music will pause when you switch to another application. Music will resume when Playnite regains focus."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <CheckBox Content="Pause music when Playnite is minimized"
                              IsChecked="{Binding Settings.PauseOnMinimize}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, music will pause when Playnite is minimized to the taskbar. Music will resume when Playnite is restored."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <CheckBox Content="Pause music when Playnite is in system tray"
                              IsChecked="{Binding Settings.PauseWhenInSystemTray}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, music will pause when Playnite is hidden in the system tray (e.g., on startup or after closing to tray). Music will resume when Playnite is restored."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <CheckBox Content="Compatibility: Pause on Play (Splash Screen Mode)"
                              IsChecked="{Binding Settings.PauseOnGameStart}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, music will pause with a fade-out as soon as you click Play on a game. Music will resume when the game closes. Useful with the Splash Screen plugin."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <CheckBox Content="Show Now Playing (Desktop mode)"
                              IsChecked="{Binding Settings.ShowNowPlayingInTopPanel}"
                              Command="{Binding SetRestartRequired}"
                              CommandParameter="{Binding RelativeSource={RelativeSource Self}}"
                              Margin="0,5"/>
                    <TextBlock FontSize="11" TextWrapping="Wrap" Margin="20,0,0,2">
                        <Run Foreground="Gray">Displays the current song title, artist, and duration.</Run>
                        <Run Foreground="Orange">Requires Playnite restart to take effect.</Run>
                    </TextBlock>

                    <CheckBox Content="Hide Now Playing for default music"
                              IsChecked="{Binding Settings.HideNowPlayingForDefaultMusic}"
                              IsEnabled="{Binding Settings.ShowNowPlayingInTopPanel}"
                              Margin="20,5,0,0"/>
                    <TextBlock Text="When enabled, the Now Playing panel is hidden when a game has no downloaded music and default/fallback music is playing"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="40,0,0,10"/>

                    <!-- Current Song Display (non-serialized, display-only) -->
                    <StackPanel Orientation="Horizontal" Margin="20,0,0,10">
                        <TextBlock Text="Current Song: "
                                   FontSize="11"
                                   Foreground="Gray"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding CurrentSongDisplay}"
                                   FontSize="11"
                                   Foreground="LightGray"
                                   FontStyle="Italic"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <CheckBox Content="Show Media Controls (Desktop mode)"
                              IsChecked="{Binding Settings.ShowDesktopMediaControls}"
                              Command="{Binding SetRestartRequired}"
                              CommandParameter="{Binding RelativeSource={RelativeSource Self}}"
                              Margin="0,5"/>
                    <TextBlock FontSize="11" TextWrapping="Wrap" Margin="20,0,0,10">
                        <Run Foreground="Gray">Displays the play/pause and skip buttons. Disable to show only the Now Playing text.</Run>
                        <Run Foreground="Orange">Requires Playnite restart to take effect.</Run>
                    </TextBlock>

                    <Separator Margin="0,15"/>

                    <!-- Music Status Tags -->
                    <TextBlock Text="Music Status Tags" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                    <TextBlock Text="Tag games based on music availability for easy filtering in Playnite" FontSize="11" Foreground="Gray" Margin="0,0,0,10"/>

                    <CheckBox Content="Auto-tag games on library update"
                              IsChecked="{Binding Settings.AutoTagOnLibraryUpdate}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, games will be automatically tagged with '[UPS] Has Music' or '[UPS] No Music' when you update your library. Use Playnite's filter to find games by tag."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10,0,5">
                        <Button Content="Scan &amp; Tag All Games"
                                Width="160"
                                Margin="0,0,10,0"
                                Command="{Binding ScanAndTagAllGamesCommand}"/>
                        <Button Content="Remove All Tags"
                                Width="140"
                                Command="{Binding RemoveAllMusicTagsCommand}"/>
                    </StackPanel>
                    <TextBlock Text="Manually scan your entire library and update music status tags. 'Remove All Tags' clears all UniPlaySong tags from your games."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,15"/>

                    <Separator Margin="0,15"/>

                    <!-- Performance -->
                    <TextBlock Text="Performance" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>

                    <CheckBox Content="Enable Song List Cache (Opt-in)"
                              IsChecked="{Binding Settings.EnableSongListCache}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, music directory lists are cached in memory during a running Playnite session (Desktop Mode = one session, switch to Fullscreen Mode = brand new session). This cache aims to mitigate any performance issues caused by repeated directory scans when scrolling between games. Cache is automatically cleared when you download, modify, or delete music, and is reset when Playnite restarts."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>
                    <TextBlock Text="⚠️ Keep this disabled if you don't notice any performance issues with game switching in your library. When cache is enabled, note that manually added music files (outside UniPlaySong) won't appear until you restart Playnite."
                               FontSize="11"
                               Foreground="#FFB74D"
                               TextWrapping="Wrap"
                               Margin="20,0,0,15"/>

                    <Separator Margin="0,15"/>

                    <!-- Troubleshooting -->
                    <TextBlock Text="Troubleshooting" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>

                    <CheckBox Content="Enable Debug Logging"
                              IsChecked="{Binding Settings.EnableDebugLogging}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, writes detailed debug information to UniPlaySong.log in the extension folder. Use this when troubleshooting issues. Disable for normal use to reduce log file size."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <Button Content="Open Log Folder"
                            Width="160"
                            Margin="0,5,0,0"
                            HorizontalAlignment="Left"
                            Command="{Binding OpenLogFolderCommand}"/>
                    <TextBlock Text="Opens the folder containing UniPlaySong.log for troubleshooting."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,15"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Playback Tab -->
        <TabItem Header="Playback">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel Margin="20">
                    <TextBlock Text="Playback Settings" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>
                    <TextBlock Text="Configure music playback, volume, fades, and default music" FontSize="11" Foreground="Gray" Margin="0,0,0,20"/>

                    <!-- Volume -->
                    <TextBlock Text="Music Volume" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                    <StackPanel Orientation="Horizontal" Margin="0,10">
                        <TextBlock Text="Music Volume: " VerticalAlignment="Center" Width="120"/>
                        <Slider Minimum="0" Maximum="100"
                                Value="{Binding Settings.MusicVolume}"
                                Width="200" Margin="0,0,10,0"/>
                        <TextBlock Text="{Binding Settings.MusicVolume}"
                                   VerticalAlignment="Center"
                                   Width="30"/>
                    </StackPanel>

                    <Separator Margin="0,15"/>

                    <!-- Fade Effects -->
                    <TextBlock Text="Fade Effects" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                    <TextBlock Text="Control how music transitions in and out" FontSize="11" Foreground="Gray" Margin="0,0,0,10"/>

                    <!-- Fade In Duration -->
                    <StackPanel Orientation="Horizontal" Margin="0,10">
                        <TextBlock Text="Fade-In Duration: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.FadeInDuration, StringFormat='{}{0:F2}'}"
                                   VerticalAlignment="Center"
                                   Width="35"
                                   Margin="0,0,3,0"/>
                        <TextBlock Text="s" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0.05" Maximum="10"
                                Value="{Binding Settings.FadeInDuration}"
                                Width="180"
                                SmallChange="0.05"
                                LargeChange="0.5"
                                TickFrequency="0.5"
                                TickPlacement="BottomRight"
                                AutoToolTipPlacement="TopLeft"
                                AutoToolTipPrecision="2"/>
                    </StackPanel>
                    <TextBlock Text="How long music fades in when starting or resuming (longer = smoother)"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <!-- Fade Out Duration -->
                    <StackPanel Orientation="Horizontal" Margin="0,10">
                        <TextBlock Text="Fade-Out Duration: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.FadeOutDuration, StringFormat='{}{0:F2}'}"
                                   VerticalAlignment="Center"
                                   Width="35"
                                   Margin="0,0,3,0"/>
                        <TextBlock Text="s" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0.05" Maximum="10"
                                Value="{Binding Settings.FadeOutDuration}"
                                Width="180"
                                SmallChange="0.05"
                                LargeChange="0.5"
                                TickFrequency="0.5"
                                TickPlacement="BottomRight"
                                AutoToolTipPlacement="TopLeft"
                                AutoToolTipPrecision="2"/>
                    </StackPanel>
                    <TextBlock Text="How long music fades out when switching games or pausing (shorter = snappier)"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <Separator Margin="0,15"/>

                    <!-- Preview Mode -->
                    <TextBlock Text="Preview Mode" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                    <TextBlock Text="Limit playback duration for game-specific music tracks" FontSize="11" Foreground="Gray" Margin="0,0,0,10"/>

                    <CheckBox Content="Enable Preview Mode"
                              IsChecked="{Binding Settings.EnablePreviewMode}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, game music will restart after the specified duration. Great for cycling through long tracks when browsing your library. Does not affect default music."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Preview Duration -->
                    <StackPanel Orientation="Horizontal" Margin="0,10">
                        <TextBlock Text="Preview Duration: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.PreviewDuration}"
                                   VerticalAlignment="Center"
                                   Width="35"
                                   Margin="0,0,3,0"/>
                        <TextBlock Text="s" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="15" Maximum="300"
                                Value="{Binding Settings.PreviewDuration}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="15"
                                TickFrequency="15"
                                TickPlacement="BottomRight"
                                AutoToolTipPlacement="TopLeft"/>
                    </StackPanel>
                    <TextBlock Text="How long each game music track plays before restarting (15-300 seconds)"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <Separator Margin="0,15"/>

                    <!-- Song Randomization -->
                    <TextBlock Text="Song Randomization" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                    <TextBlock Text="Control when songs are randomized during playback" FontSize="11" Foreground="Gray" Margin="0,0,0,10"/>

                    <CheckBox Content="Randomize song upon selection"
                              IsChecked="{Binding Settings.RandomizeOnEverySelect}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, a random song will be selected each time you select a game (after primary song plays). Provides variety when browsing your library."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <CheckBox Content="Randomize song when current song ends"
                              IsChecked="{Binding Settings.RandomizeOnMusicEnd}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, after the current song finishes, a new random song will be selected from available songs. Creates automatic variety during extended listening."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <CheckBox Content="Stop after song ends (no loop)"
                              IsChecked="{Binding Settings.StopAfterSongEnds}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, music stops after the current song finishes instead of looping or advancing to the next song. Applies to both regular playback and preview mode."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,15"/>

                    <Separator Margin="0,15"/>

                    <!-- Default Music -->
                    <TextBlock Text="Default Music" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                    <TextBlock Text="Play fallback music when no game music is found" FontSize="11" Foreground="Gray" Margin="0,0,0,10"/>

                    <CheckBox Content="Enable Default Music"
                              IsChecked="{Binding Settings.EnableDefaultMusic}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, plays default music when a selected game has no music files"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Default Music Source: Bundled Preset -->
                    <RadioButton Content="Use bundled preset"
                                 IsChecked="{Binding Settings.DefaultMusicSourceOption, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=BundledPreset}"
                                 IsEnabled="{Binding Settings.EnableDefaultMusic}"
                                 GroupName="DefaultMusicSource"
                                 Margin="0,5"/>
                    <StackPanel Orientation="Horizontal" Margin="20,5,0,0">
                        <TextBlock Text="Preset: " VerticalAlignment="Center"/>
                        <ComboBox ItemsSource="{Binding BundledPresets}"
                                  SelectedValue="{Binding Settings.SelectedBundledPreset}"
                                  SelectedValuePath="File"
                                  DisplayMemberPath="DisplayName"
                                  IsEnabled="{Binding Settings.EnableDefaultMusic}"
                                  Width="350"
                                  Margin="5,0,0,0"/>
                    </StackPanel>
                    <TextBlock Text="Ships with the plugin — ambient tracks licensed under Pixabay Content License"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,3,0,10"/>

                    <!-- Default Music Source: Custom File -->
                    <RadioButton Content="Use custom music file"
                                 IsChecked="{Binding Settings.DefaultMusicSourceOption, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=CustomFile}"
                                 IsEnabled="{Binding Settings.EnableDefaultMusic}"
                                 GroupName="DefaultMusicSource"
                                 Margin="0,5"/>
                    <StackPanel Orientation="Horizontal" Margin="20,5,0,0">
                        <TextBox Text="{Binding Settings.DefaultMusicPath}"
                                 Width="330"
                                 Margin="0,0,10,0"
                                 IsReadOnly="True"
                                 IsEnabled="{Binding Settings.EnableDefaultMusic}"/>
                        <Button Content="Browse..."
                                Width="80"
                                Margin="0,0,5,0"
                                IsEnabled="{Binding Settings.EnableDefaultMusic}"
                                Command="{Binding BrowseForDefaultMusicFile}"/>
                        <Button Content="Download..."
                                Width="90"
                                IsEnabled="{Binding Settings.EnableDefaultMusic}"
                                Command="{Binding DownloadDefaultMusic}"/>
                    </StackPanel>
                    <TextBlock Text="Select a music file (MP3, WAV, FLAC, etc.) to play when no game music is available"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,3,0,10"/>

                    <!-- Default Music Source: Native Theme -->
                    <RadioButton Content="Use Playnite native theme music"
                                 IsChecked="{Binding Settings.DefaultMusicSourceOption, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=NativeTheme}"
                                 IsEnabled="{Binding Settings.EnableDefaultMusic}"
                                 GroupName="DefaultMusicSource"
                                 Margin="0,5"/>
                    <TextBlock Text="Uses Playnite's vanilla default theme background music"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <Separator Margin="0,15"/>

                    <CheckBox Content="Play Music Only for Installed Games"
                              IsChecked="{Binding Settings.MusicOnlyForInstalledGames}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, game-specific music only plays for games installed on your machine. Uninstalled games will use default music instead (or be silent if default music is off)."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Live Effects Tab -->
        <TabItem Header="Live Effects">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel Margin="20">
                    <TextBlock Text="Live Audio Effects" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>
                    <TextBlock Text="Apply real-time audio effects during playback using NAudio processing. Requires enabling the master toggle below."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,20"/>

                    <!-- Master Toggle -->
                    <CheckBox Content="Enable Live Effects"
                              IsChecked="{Binding Settings.LiveEffectsEnabled}"
                              Margin="0,5"/>
                    <TextBlock Text="Enables NAudio-based audio processing with real-time effects. When toggled, the current song will restart from the beginning using the new audio player. Effects below only work when this is enabled."
                               FontSize="11"
                               Foreground="#FFA500"
                               FontWeight="SemiBold"
                               TextWrapping="Wrap"
                               Margin="20,0,0,20"/>

                    <!-- Style Preset Section -->
                    <TextBlock Text="Style Preset" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>
                    <TextBlock Text="Quick-start styles that configure all effects at once. Selecting a style will override your current effect settings. Set to 'None' for manual control."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Style: " VerticalAlignment="Center" Width="120"/>
                        <ComboBox SelectedIndex="{Binding Settings.SelectedStylePreset, Converter={StaticResource StylePresetConverter}}"
                                  Width="200">
                            <ComboBoxItem Content="None (Manual)"/>
                            <ComboBoxItem Content="Huddini - Rehearsal"/>
                            <ComboBoxItem Content="Huddini - Bright Room"/>
                            <ComboBoxItem Content="Huddini - Retro Radio"/>
                            <ComboBoxItem Content="Huddini - Lo-Bit"/>
                            <ComboBoxItem Content="Huddini - Slowed Dream (Slow)"/>
                            <ComboBoxItem Content="Huddini - Cave Lake (Slow)"/>
                            <ComboBoxItem Content="Huddini - Honey Room (Slow)"/>
                            <ComboBoxItem Content="Clean Boost"/>
                            <ComboBoxItem Content="Warm FM Radio"/>
                            <ComboBoxItem Content="Bright &amp; Airy"/>
                            <ComboBoxItem Content="Telephone"/>
                            <ComboBoxItem Content="Concert Live"/>
                            <ComboBoxItem Content="Muffled Next Room"/>
                            <ComboBoxItem Content="Lo-Fi Chill (Slow)"/>
                            <ComboBoxItem Content="Slowed + Reverb (Slow)"/>
                            <ComboBoxItem Content="Vinyl Night (Slow)"/>
                            <ComboBoxItem Content="Underwater Dream (Slow)"/>
                            <ComboBoxItem Content="Cyberpunk (Slow)"/>
                        </ComboBox>
                    </StackPanel>
                    <TextBlock Text="Each style creatively combines filters, reverb, slow effect, and more. After selecting a style, tweaking any individual setting below will automatically switch back to 'None (Manual)' so your changes are preserved."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <StackPanel Orientation="Horizontal" Margin="0,5,0,5">
                        <Button Content="Copy Current Settings to Clipboard"
                                Click="CopyLiveEffectsToClipboard_Click"
                                Padding="12,4"
                                Margin="0,0,10,0"/>
                        <Button Content="Reset All Effects to Defaults"
                                Click="ResetLiveEffects_Click"
                                Padding="12,4"/>
                    </StackPanel>

                    <Separator Margin="0,15"/>

                    <!-- High-Pass Filter Section -->
                    <TextBlock Text="High-Pass Filter" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>
                    <TextBlock Text="Removes low frequencies below the cutoff point. Useful for reducing rumble or bass."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <CheckBox Content="Enable High-Pass Filter"
                              IsChecked="{Binding Settings.HighPassEnabled}"
                              IsEnabled="{Binding Settings.LiveEffectsEnabled}"
                              Margin="0,5"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Cutoff Frequency: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.HighPassCutoff}"
                                   VerticalAlignment="Center"
                                   Width="45"/>
                        <TextBlock Text="Hz" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="20" Maximum="2000"
                                Value="{Binding Settings.HighPassCutoff}"
                                Width="180"
                                SmallChange="10"
                                LargeChange="100"
                                TickFrequency="200"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Frequencies below this value will be attenuated. Default: 80 Hz (subtle rumble removal)"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <Separator Margin="0,15"/>

                    <!-- Low-Pass Filter Section -->
                    <TextBlock Text="Low-Pass Filter" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>
                    <TextBlock Text="Removes high frequencies above the cutoff point. Creates a muffled or underwater effect."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <CheckBox Content="Enable Low-Pass Filter"
                              IsChecked="{Binding Settings.LowPassEnabled}"
                              IsEnabled="{Binding Settings.LiveEffectsEnabled}"
                              Margin="0,5"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Cutoff Frequency: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.LowPassCutoff}"
                                   VerticalAlignment="Center"
                                   Width="45"/>
                        <TextBlock Text="Hz" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="200" Maximum="20000"
                                Value="{Binding Settings.LowPassCutoff}"
                                Width="180"
                                SmallChange="100"
                                LargeChange="1000"
                                TickFrequency="2000"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Frequencies above this value will be attenuated. Default: 8000 Hz (subtle high-end rolloff)"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <Separator Margin="0,15"/>

                    <!-- Slow Effect Section -->
                    <TextBlock Text="Slow Effect" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>
                    <TextBlock Text="Reduces playback speed with proportional pitch drop. Creates the classic 'slowed' aesthetic — like a vinyl record playing at a lower RPM."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <CheckBox Content="Enable Slow Effect"
                              IsChecked="{Binding Settings.SlowEnabled}"
                              IsEnabled="{Binding Settings.LiveEffectsEnabled}"
                              Margin="0,5"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Slow Amount: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.SlowAmount}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="50"
                                Value="{Binding Settings.SlowAmount}"
                                Width="180"
                                SmallChange="1"
                                LargeChange="5"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="0% = normal speed, 25% = 0.75x speed, 50% = half speed. Higher values = slower playback and lower pitch."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>
                    <TextBlock Text="Tip: Loud or unnormalized songs may clip when slowed. Use Makeup Gain with a negative value (e.g. -3 to -6 dB) to reduce the input level if you hear distortion."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <Separator Margin="0,15"/>

                    <!-- Stereo Widener Section -->
                    <TextBlock Text="Stereo Widener" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>
                    <TextBlock Text="Adjusts the stereo image using mid-side processing. Widen for an immersive feel or narrow toward mono."
                               FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="0,0,0,10"/>
                    <CheckBox Content="Enable Stereo Widener" IsChecked="{Binding Settings.StereoWidenerEnabled}" IsEnabled="{Binding Settings.LiveEffectsEnabled}" Margin="0,5"/>
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Width: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.StereoWidenerWidth}" VerticalAlignment="Center" Width="35"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100" Value="{Binding Settings.StereoWidenerWidth}" Width="180" SmallChange="5" LargeChange="10" TickFrequency="10" TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="0% = mono, 50% = normal stereo (unchanged), 100% = maximum widening. Default: 50%" FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="20,0,0,10"/>

                    <Separator Margin="0,15"/>

                    <!-- Chorus Section -->
                    <TextBlock Text="Chorus" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>
                    <TextBlock Text="Thickens the sound by mixing in a slightly delayed, pitch-modulated copy. Creates a lush doubling effect."
                               FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="0,0,0,10"/>
                    <CheckBox Content="Enable Chorus" IsChecked="{Binding Settings.ChorusEnabled}" IsEnabled="{Binding Settings.LiveEffectsEnabled}" Margin="0,5"/>
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Rate: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ChorusRate}" VerticalAlignment="Center" Width="35"/>
                        <TextBlock Text="(×0.1 Hz)" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="1" Maximum="50" Value="{Binding Settings.ChorusRate}" Width="180" SmallChange="1" LargeChange="5" TickFrequency="5" TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="LFO speed. 10 = 1.0 Hz, 30 = 3.0 Hz. Slower = gentle sway, faster = vibrato. Default: 30 (3.0 Hz)" FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="20,0,0,5"/>
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Depth: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ChorusDepth}" VerticalAlignment="Center" Width="35"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100" Value="{Binding Settings.ChorusDepth}" Width="180" SmallChange="5" LargeChange="10" TickFrequency="10" TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="How much the delay time wobbles. Higher = more pitch variation. Default: 50%" FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="20,0,0,5"/>
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Mix: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ChorusMix}" VerticalAlignment="Center" Width="35"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100" Value="{Binding Settings.ChorusMix}" Width="180" SmallChange="5" LargeChange="10" TickFrequency="10" TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Wet/dry blend. 0% = dry, 100% = fully chorused. Default: 40%" FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="20,0,0,10"/>

                    <Separator Margin="0,15"/>

                    <!-- Bitcrusher Section -->
                    <TextBlock Text="Bitcrusher" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>
                    <TextBlock Text="Reduces bit depth and sample rate for lo-fi digital distortion. Creates retro, crunchy, or chiptune-style effects."
                               FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="0,0,0,10"/>
                    <CheckBox Content="Enable Bitcrusher" IsChecked="{Binding Settings.BitcrusherEnabled}" IsEnabled="{Binding Settings.LiveEffectsEnabled}" Margin="0,5"/>
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Bit Depth: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.BitcrusherBitDepth}" VerticalAlignment="Center" Width="35"/>
                        <TextBlock Text="bits" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="2" Maximum="16" Value="{Binding Settings.BitcrusherBitDepth}" Width="180" SmallChange="1" LargeChange="2" TickFrequency="2" TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Audio resolution. 16 = CD quality (subtle), 8 = retro, 4 = crunchy, 2 = extreme. Default: 8" FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="20,0,0,5"/>
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Downsample: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.BitcrusherDownsample}" VerticalAlignment="Center" Width="35"/>
                        <TextBlock Text="×" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="1" Maximum="32" Value="{Binding Settings.BitcrusherDownsample}" Width="180" SmallChange="1" LargeChange="4" TickFrequency="4" TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Sample rate reduction. 1 = none, 4 = gritty, 16+ = heavily degraded. Default: 1" FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="20,0,0,10"/>

                    <Separator Margin="0,15"/>

                    <!-- Tremolo Section -->
                    <TextBlock Text="Tremolo" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>
                    <TextBlock Text="Periodic volume modulation that creates a pulsing, wavering effect. Slow rates feel atmospheric, fast rates feel intense."
                               FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="0,0,0,10"/>
                    <CheckBox Content="Enable Tremolo" IsChecked="{Binding Settings.TremoloEnabled}" IsEnabled="{Binding Settings.LiveEffectsEnabled}" Margin="0,5"/>
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Rate: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.TremoloRate}" VerticalAlignment="Center" Width="35"/>
                        <TextBlock Text="(×0.1 Hz)" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="1" Maximum="100" Value="{Binding Settings.TremoloRate}" Width="180" SmallChange="1" LargeChange="10" TickFrequency="10" TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Pulse speed. 10 = 1.0 Hz (slow swell), 40 = 4.0 Hz (classic tremolo), 80+ = fast flutter. Default: 40 (4.0 Hz)" FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="20,0,0,5"/>
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Depth: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.TremoloDepth}" VerticalAlignment="Center" Width="35"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100" Value="{Binding Settings.TremoloDepth}" Width="180" SmallChange="5" LargeChange="10" TickFrequency="10" TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="How much the volume swings. 0% = no effect, 50% = moderate pulse, 100% = full silence-to-loud. Default: 50%" FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="20,0,0,10"/>

                    <Separator Margin="0,15"/>

                    <!-- Reverb Section -->
                    <TextBlock Text="Reverb" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>
                    <TextBlock Text="Adds spatial depth and ambience to the audio. Creates a sense of space or room. Based on libSoX/Audacity algorithm."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <CheckBox Content="Enable Reverb"
                              IsChecked="{Binding Settings.ReverbEnabled}"
                              IsEnabled="{Binding Settings.LiveEffectsEnabled}"
                              Margin="0,5"/>

                    <!-- Preset Dropdown -->
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Preset: " VerticalAlignment="Center" Width="120"/>
                        <ComboBox SelectedIndex="{Binding Settings.SelectedReverbPreset, Converter={StaticResource ReverbPresetConverter}}"
                                  Width="200">
                            <ComboBoxItem Content="Custom"/>
                            <!-- General Purpose (Audacity) -->
                            <ComboBoxItem Content="Acoustic"/>
                            <ComboBoxItem Content="Ambience"/>
                            <ComboBoxItem Content="Artificial"/>
                            <ComboBoxItem Content="Clean"/>
                            <ComboBoxItem Content="Modern"/>
                            <!-- Vocals (Audacity) -->
                            <ComboBoxItem Content="Vocal I"/>
                            <ComboBoxItem Content="Vocal II"/>
                            <ComboBoxItem Content="Dance Vocal"/>
                            <ComboBoxItem Content="Modern Vocal"/>
                            <ComboBoxItem Content="Voice Tail"/>
                            <!-- Room Sizes (Audacity) -->
                            <ComboBoxItem Content="Bathroom"/>
                            <ComboBoxItem Content="Small Room Bright"/>
                            <ComboBoxItem Content="Small Room Dark"/>
                            <ComboBoxItem Content="Medium Room"/>
                            <ComboBoxItem Content="Large Room"/>
                            <ComboBoxItem Content="Church Hall"/>
                            <ComboBoxItem Content="Cathedral"/>
                            <ComboBoxItem Content="Big Cave"/>
                            <!-- Living/Entertainment (UniPlaySong) -->
                            <ComboBoxItem Content="Living Room"/>
                            <ComboBoxItem Content="Home Theater"/>
                            <ComboBoxItem Content="Late Night TV"/>
                            <ComboBoxItem Content="Lounge/Cafe"/>
                            <ComboBoxItem Content="Jazz Club"/>
                            <ComboBoxItem Content="Night Club"/>
                            <ComboBoxItem Content="Concert Hall"/>
                            <!-- Creative/Stylistic (UniPlaySong) -->
                            <ComboBoxItem Content="Dreamy"/>
                            <ComboBoxItem Content="Lo-Fi"/>
                            <ComboBoxItem Content="Underwater"/>
                            <ComboBoxItem Content="Sci-Fi Corridor"/>
                            <ComboBoxItem Content="Vinyl Warmth"/>
                            <ComboBoxItem Content="Vaporwave"/>
                        </ComboBox>
                    </StackPanel>
                    <TextBlock Text="Audacity-compatible presets plus UniPlaySong environments (Living Room, Home Theater, etc.). Adjusting sliders sets preset to 'Custom'."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Room Size -->
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Room Size: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbRoomSize}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100"
                                Value="{Binding Settings.ReverbRoomSize}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Size of the virtual room. Small (0%) = tight/short reverb, Large (100%) = cathedral-like. Default: 75%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Reverberance (Audacity parameter) -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Reverberance: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbReverberance}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100"
                                Value="{Binding Settings.ReverbReverberance}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Length of reverb tail. Higher = longer, more 'live' reverb. Key for pronounced effects. Default: 50%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Pre-Delay -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Pre-Delay: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbPreDelay}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="ms" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="200"
                                Value="{Binding Settings.ReverbPreDelay}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="20"
                                TickFrequency="20"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Delay before reverb starts. Creates sense of distance. 0ms = close, 100ms+ = distant/large space. Default: 10 ms"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Stereo Width -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Stereo Width: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbStereoWidth}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100"
                                Value="{Binding Settings.ReverbStereoWidth}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Stereo spread of reverb. 0% = mono reverb, 100% = full stereo. Default: 100%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Wet/Dry Mix -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Wet/Dry Mix: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbMix}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100"
                                Value="{Binding Settings.ReverbMix}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Wet/dry crossfade. 0% = no reverb, 50% = balanced blend, 100% = full reverb effect. Default: 50%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Wet Gain (Reverb volume) -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Wet Gain: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbWetGain}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="dB" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="-20" Maximum="10"
                                Value="{Binding Settings.ReverbWetGain}"
                                Width="180"
                                SmallChange="1"
                                LargeChange="3"
                                TickFrequency="5"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Volume of the reverb effect. Positive values = more pronounced reverb. Range: -20 to +10 dB. Default: -6 dB"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Dry Gain (Original volume) -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Dry Gain: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbDryGain}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="dB" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="-20" Maximum="0"
                                Value="{Binding Settings.ReverbDryGain}"
                                Width="180"
                                SmallChange="1"
                                LargeChange="3"
                                TickFrequency="2"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Volume of the original (dry) signal. 0 dB = full, -20 dB = very quiet. Default: 0 dB"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Damping (HF absorption) -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Damping: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbDamping}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100"
                                Value="{Binding Settings.ReverbDamping}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="High-frequency absorption. Higher = more muffled/darker reverb tail. Default: 50%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Tone Low (Audacity parameter) -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Tone Low: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbToneLow}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100"
                                Value="{Binding Settings.ReverbToneLow}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Bass content of reverb. Lower = less boomy, tighter reverb. Default: 100%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Tone High (Audacity parameter) -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Tone High: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbToneHigh}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100"
                                Value="{Binding Settings.ReverbToneHigh}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Treble content of reverb. Lower = darker, less bright reverb. Default: 100%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,15"/>

                    <Separator Margin="0,10"/>

                    <!-- Makeup Gain Section -->
                    <TextBlock Text="Output Gain" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>
                    <TextBlock Text="Final gain stage applied after all effects. Use to compensate for volume changes."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <CheckBox Content="Enable Makeup Gain"
                              IsChecked="{Binding Settings.MakeupGainEnabled}"
                              IsEnabled="{Binding Settings.LiveEffectsEnabled}"
                              Margin="0,5"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Gain: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.MakeupGain}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="dB" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="-6" Maximum="12"
                                Value="{Binding Settings.MakeupGain}"
                                Width="180"
                                SmallChange="1"
                                LargeChange="3"
                                TickFrequency="3"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Boost or cut output volume. Uses soft-knee limiting to prevent harsh clipping. Default: 0 dB"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,15"/>

                    <Separator Margin="0,10"/>

                    <!-- Effect Chain Order Section -->
                    <TextBlock Text="Effect Chain Order" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>
                    <TextBlock Text="Controls the order in which effects are applied. Default is High-Pass → Low-Pass → Reverb (recommended)."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Chain Order: " VerticalAlignment="Center" Width="120"/>
                        <ComboBox SelectedIndex="{Binding Settings.EffectChainPreset, Converter={StaticResource EffectChainPresetConverter}}"
                                  Width="220">
                            <ComboBoxItem Content="High-Pass → Low-Pass → Reverb (Recommended)"/>
                            <ComboBoxItem Content="Reverb → High-Pass → Low-Pass"/>
                            <ComboBoxItem Content="Low-Pass → High-Pass → Reverb"/>
                            <ComboBoxItem Content="Low-Pass → Reverb → High-Pass"/>
                            <ComboBoxItem Content="High-Pass → Reverb → Low-Pass"/>
                            <ComboBoxItem Content="Reverb → Low-Pass → High-Pass"/>
                        </ComboBox>
                    </StackPanel>
                    <TextBlock Text="Be careful: Reverb-first orderings can cause unusual or harsh sounds with certain filter settings."
                               FontSize="11"
                               Foreground="#FFA500"
                               FontWeight="SemiBold"
                               TextWrapping="Wrap"
                               Margin="20,5,0,15"/>

                    <Separator Margin="0,10"/>

                    <!-- Advanced Reverb Tuning Section -->
                    <TextBlock Text="Advanced Reverb Tuning" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>
                    <TextBlock Text="Expert-level parameters that affect the reverb algorithm behavior. For audio engineers and enthusiasts."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <CheckBox Content="Enable Advanced Tuning"
                              IsChecked="{Binding Settings.AdvancedReverbTuningEnabled}"
                              IsEnabled="{Binding Settings.LiveEffectsEnabled}"
                              Margin="0,5"/>
                    <TextBlock Text="⚠️ WARNING: These settings can produce VERY LOUD output that may damage your hearing or speakers! Only enable if you understand the reverb algorithm. Use at your own risk."
                               FontSize="11"
                               Foreground="#FF4444"
                               FontWeight="Bold"
                               TextWrapping="Wrap"
                               Margin="20,0,0,15"/>

                    <!-- Wet Gain Multiplier -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.AdvancedReverbTuningEnabled}">
                        <TextBlock Text="Wet Multiplier: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbWetGainMultiplier, StringFormat='0.{0:D2}'}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <Slider Minimum="1" Maximum="25"
                                Value="{Binding Settings.ReverbWetGainMultiplier}"
                                Width="180"
                                SmallChange="1"
                                LargeChange="5"
                                TickFrequency="5"
                                TickPlacement="BottomRight"
                                Margin="10,0,0,0"/>
                    </StackPanel>
                    <TextBlock Text="Scales reverb intensity (0.01-0.25). Default: 0.03. Higher = more reverb but risk of distortion. Values &gt;0.15 can be VERY loud!"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- HF Damping Min -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.AdvancedReverbTuningEnabled}">
                        <TextBlock Text="HF Damp Min: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbHfDampingMin, StringFormat='0.{0:D2}'}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <Slider Minimum="10" Maximum="40"
                                Value="{Binding Settings.ReverbHfDampingMin}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"
                                Margin="10,0,0,0"/>
                    </StackPanel>
                    <TextBlock Text="Minimum damping at 0% setting (0.10-0.40). Default: 0.20. Lower = brighter reverb."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- HF Damping Max -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.AdvancedReverbTuningEnabled}">
                        <TextBlock Text="HF Damp Max: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbHfDampingMax, StringFormat='0.{0:D2}'}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <Slider Minimum="30" Maximum="70"
                                Value="{Binding Settings.ReverbHfDampingMax}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"
                                Margin="10,0,0,0"/>
                    </StackPanel>
                    <TextBlock Text="Maximum damping at 100% setting (0.30-0.70). Default: 0.50. Higher = darker reverb at max damping."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,15"/>

                    <Separator Margin="0,10"/>

                    <!-- Spectrum Visualizer -->
                    <TextBlock Text="Spectrum Visualizer" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>
                    <TextBlock Text="Real-time 8-bar frequency spectrum visualizer for the Desktop top panel. Tune the animation behavior to your preference."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <CheckBox Content="Show Spectrum Visualizer in Top Panel"
                              IsChecked="{Binding Settings.ShowSpectrumVisualizer}"
                              Margin="0,5"/>
                    <TextBlock Text="Displays a real-time frequency spectrum visualizer in the Desktop top panel bar alongside media controls."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Visualizer Preset -->
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="Viz Preset: " VerticalAlignment="Center" Width="120"/>
                        <ComboBox SelectedIndex="{Binding Settings.SelectedVizPreset, Converter={StaticResource VizPresetConverter}}"
                                  SelectionChanged="VizPreset_SelectionChanged"
                                  Width="200">
                            <ComboBoxItem Content="Custom"/>
                            <ComboBoxItem Content="Default"/>
                            <ComboBoxItem Content="Smooth"/>
                            <ComboBoxItem Content="Punchy"/>
                            <ComboBoxItem Content="Cinematic"/>
                            <ComboBoxItem Content="Minimal"/>
                            <ComboBoxItem Content="Reactive"/>
                        </ComboBox>
                    </StackPanel>
                    <TextBlock Text="Select a preset to configure all visualizer parameters at once. Choose 'Custom' to keep your current settings. Selecting a preset overwrites all values below — you can then fine-tune."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Color Theme (top-level, next to preset) -->
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="Color Theme: " VerticalAlignment="Center" Width="120"/>
                        <ComboBox SelectedIndex="{Binding Settings.VizColorTheme, Converter={StaticResource VizColorThemeConverter}}"
                                  Width="200">
                            <ComboBoxItem Content="Dynamic (Game Art V1)"/>
                            <ComboBoxItem Content="Classic (White)"/>
                            <ComboBoxItem Content="Neon (Cyan → Magenta)"/>
                            <ComboBoxItem Content="Fire (Orange → Red)"/>
                            <ComboBoxItem Content="Ocean (Teal → Blue)"/>
                            <ComboBoxItem Content="Sunset (Yellow → Pink)"/>
                            <ComboBoxItem Content="Matrix (Green)"/>
                            <ComboBoxItem Content="Ice (White → Blue)"/>
                            <ComboBoxItem Content="Synthwave (Purple → Pink)"/>
                            <ComboBoxItem Content="Ember (Ember → Amber)"/>
                            <ComboBoxItem Content="Abyss (Navy → Aqua)"/>
                            <ComboBoxItem Content="Solar (Rust → Gold)"/>
                            <ComboBoxItem Content="Vapor (Mint → Lavender)"/>
                            <ComboBoxItem Content="Frost (Steel → White)"/>
                            <ComboBoxItem Content="Dynamic (Vibrant Vibes)"/>
                            <ComboBoxItem Content="Aurora (Teal → Lime)"/>
                            <ComboBoxItem Content="Coral (Coral → Peach)"/>
                            <ComboBoxItem Content="Plasma (Indigo → Red)"/>
                            <ComboBoxItem Content="Toxic (Acid → Purple)"/>
                            <ComboBoxItem Content="Cherry (Cherry → Rose)"/>
                            <ComboBoxItem Content="Midnight (Indigo → Cyan)"/>
                            <ComboBoxItem Content="Dynamic (Alt Algo)"/>
                        </ComboBox>
                    </StackPanel>
                    <TextBlock Text="Bar color theme. Gradient colors shift from bottom to top of each bar. Classic uses the original white style. Game Art V1 samples natural tones from game artwork. Alt Algo uses advanced center-weighted sampling for potentially better color picks. Vibrant Vibes forces vivid, creative color gradients with strong contrast."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <Button Content="Reset Dynamic Colors Cache"
                            Width="200"
                            Margin="0,0,0,5"
                            HorizontalAlignment="Left"
                            Command="{Binding ResetDynamicColorCacheCommand}"/>
                    <TextBlock Text="Clears cached color data so all games re-sample from their artwork."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Dynamic Color Tuning (V1 + Alt Algo — Vibrant Vibes uses hardcoded vivid params) -->
                    <TextBlock Text="Dynamic Color Tuning (Experimental)"
                               FontWeight="SemiBold"
                               Margin="0,10,0,0"
                               IsEnabled="{Binding Settings.ShowSpectrumVisualizer}"/>
                    <TextBlock Text="Fine-tune how colors are extracted from game artwork for Dynamic V1 and Alt Algo. Vibrant Vibes uses its own aggressive settings. Most users won't need to change these."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="Min Brightness (Base): " VerticalAlignment="Center" Width="170"/>
                        <TextBlock Text="{Binding Settings.DynMinBrightnessBottom}"
                                   VerticalAlignment="Center"
                                   Width="30"/>
                        <Slider Minimum="30" Maximum="220"
                                Value="{Binding Settings.DynMinBrightnessBottom}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="20"
                                TickFrequency="30"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Minimum brightness for the gradient base color. Higher = brighter bars from dark artwork. Default: 200"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="Min Brightness (Tip): " VerticalAlignment="Center" Width="170"/>
                        <TextBlock Text="{Binding Settings.DynMinBrightnessTop}"
                                   VerticalAlignment="Center"
                                   Width="30"/>
                        <Slider Minimum="30" Maximum="220"
                                Value="{Binding Settings.DynMinBrightnessTop}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="20"
                                TickFrequency="30"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Minimum brightness for the gradient tip color. Higher = more vivid peaks. Default: 150"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="Min Saturation (Base): " VerticalAlignment="Center" Width="170"/>
                        <TextBlock Text="{Binding Settings.DynMinSatBottom}"
                                   VerticalAlignment="Center"
                                   Width="30"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="80"
                                Value="{Binding Settings.DynMinSatBottom}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Minimum color saturation for the gradient base. Higher = more vivid, less washed out. Default: 30%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="Min Saturation (Tip): " VerticalAlignment="Center" Width="170"/>
                        <TextBlock Text="{Binding Settings.DynMinSatTop}"
                                   VerticalAlignment="Center"
                                   Width="30"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="80"
                                Value="{Binding Settings.DynMinSatTop}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Minimum color saturation for the gradient tip. Higher = more vivid peaks. Default: 35%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <Button Content="Reset to Defaults"
                            Width="140"
                            Margin="0,5,0,10"
                            HorizontalAlignment="Left"
                            Command="{Binding ResetDynamicTuningCommand}"/>

                    <!-- Advanced Customization (collapsed by default) -->
                    <Expander Header="Advanced Customization (Experimental)"
                              IsExpanded="False"
                              Margin="0,10,0,0"
                              IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <StackPanel Margin="10,10,0,0">

                    <TextBlock Text="Fine-tune individual visualizer parameters. Most users should use the presets above."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <!-- Gradient Toggle -->
                    <CheckBox Content="Enable Gradient Bars"
                              IsChecked="{Binding Settings.VizGradientEnabled}"
                              IsEnabled="{Binding Settings.ShowSpectrumVisualizer}"
                              Margin="0,5,0,0"/>
                    <TextBlock Text="When enabled, non-Classic themes use a two-tone gradient. When disabled, bars use a solid color."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <Separator Margin="0,0,0,10"/>

                    <!-- Opacity Min -->
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="Idle Opacity: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.VizOpacityMin}"
                                   VerticalAlignment="Center"
                                   Width="30"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100"
                                Value="{Binding Settings.VizOpacityMin}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="20"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Bar opacity when idle. Lower = stronger glow/pulse effect. 100 = no opacity change. Default: 30%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <!-- Gain Boost -->
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="Gain Boost: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.VizBarGainBoost}"
                                   VerticalAlignment="Center"
                                   Width="30"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="-50" Maximum="100"
                                Value="{Binding Settings.VizBarGainBoost}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="25"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Global gain offset applied to all bars. Positive = taller peaks, negative = subtler. Default: 0%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <!-- Peak Hold -->
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="Peak Hold: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.VizPeakHoldMs}"
                                   VerticalAlignment="Center"
                                   Width="30"/>
                        <TextBlock Text="ms" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="300"
                                Value="{Binding Settings.VizPeakHoldMs}"
                                Width="180"
                                SmallChange="10"
                                LargeChange="50"
                                TickFrequency="50"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="How long bars hold at peak before falling. 0 = instant drop, 300 = long freeze. Default: 80ms"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <!-- Gravity -->
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="Gravity: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.VizGravity}"
                                   VerticalAlignment="Center"
                                   Width="30"/>
                        <Slider Minimum="10" Maximum="200"
                                Value="{Binding Settings.VizGravity}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="20"
                                TickFrequency="30"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Base fall acceleration. Higher = bars drop faster after peaks. Lower = floaty trails. Default: 80"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <!-- Bass/Treble Gravity Bias -->
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="Bass Punch: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.VizBassGravityBias}"
                                   VerticalAlignment="Center"
                                   Width="30"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100"
                                Value="{Binding Settings.VizBassGravityBias}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="20"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Bass/treble gravity contrast. 0 = all bars same speed. Higher = bass snappy + treble floaty. Default: 50%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <!-- FFT Size -->
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="FFT Size: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.VizFftSize}"
                                   VerticalAlignment="Center"
                                   Width="40"/>
                        <Slider Minimum="512" Maximum="2048"
                                Value="{Binding Settings.VizFftSize}"
                                Width="180"
                                SmallChange="512"
                                LargeChange="1024"
                                TickFrequency="512"
                                IsSnapToTickEnabled="True"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="FFT analysis window size. 512 = snappy but coarse bass. 1024 = balanced. 2048 = precise but slower attack. Requires song restart. Default: 1024"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <!-- Bass Gain -->
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="Bass Gain: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.VizBassGain}"
                                   VerticalAlignment="Center"
                                   Width="30"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="200"
                                Value="{Binding Settings.VizBassGain}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="20"
                                TickFrequency="25"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Scales gain for bass bars (sub-bass through vocal presence). Lower = shorter bass bars. Higher = taller. Default: 100%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <!-- Treble Gain -->
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="Treble Gain: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.VizTrebleGain}"
                                   VerticalAlignment="Center"
                                   Width="30"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="200"
                                Value="{Binding Settings.VizTrebleGain}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="20"
                                TickFrequency="25"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Scales gain for treble bars (upper vocal through high treble). Lower = shorter treble bars. Higher = taller. Default: 100%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <!-- Bleed Amount -->
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="Freq Bleed: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.VizBleedAmount}"
                                   VerticalAlignment="Center"
                                   Width="30"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="200"
                                Value="{Binding Settings.VizBleedAmount}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="20"
                                TickFrequency="25"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="How much energy bleeds between adjacent bars. 0 = bars independent. 100 = default coupling. 200 = heavy bleed. Default: 100%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <!-- Compression -->
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="Compression: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.VizCompression}"
                                   VerticalAlignment="Center"
                                   Width="30"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100"
                                Value="{Binding Settings.VizCompression}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Soft-knee peak compression. 0 = no compression (linear). Higher = peaks tamed more aggressively, bars more uniform. Default: 50%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <!-- Smooth Rise -->
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="Smooth Rise: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.VizSmoothRise}"
                                   VerticalAlignment="Center"
                                   Width="30"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100"
                                Value="{Binding Settings.VizSmoothRise}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="How quickly bars respond to rising energy (beat attack). Higher = snappier. Lower = sluggish. Default: 85%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <!-- Smooth Fall -->
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="Smooth Fall: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.VizSmoothFall}"
                                   VerticalAlignment="Center"
                                   Width="30"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100"
                                Value="{Binding Settings.VizSmoothFall}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="How quickly bars decay after energy drops. Lower = smoother trailing. Higher = snappy drop. Default: 15%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <Separator Margin="0,5,0,10"/>

                    <!-- FFT Smoothing Alphas -->
                    <TextBlock Text="FFT Smoothing (Advanced)"
                               FontSize="14" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <TextBlock Text="Controls the pre-render FFT temporal smoothing. These shape how the raw spectrum data responds before it reaches the UI. Changes apply live."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <!-- FFT Timer Mode -->
                    <CheckBox Content="Use Fixed Timer (~62fps)"
                              IsChecked="{Binding Settings.VizFftTimerMode}"
                              IsEnabled="{Binding Settings.ShowSpectrumVisualizer}"
                              Margin="0,0,0,0"/>
                    <TextBlock Text="Signal mode (default): FFT runs when audio delivers new samples (~43fps at 1024). Timer mode: FFT runs at a fixed ~62fps matching the UI refresh rate. Timer uses slightly more CPU but may feel smoother."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- FFT Rise Low (bass attack) -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="FFT Rise (Bass): " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.VizFftRiseLow}"
                                   VerticalAlignment="Center"
                                   Width="30"/>
                        <Slider Minimum="0" Maximum="95"
                                Value="{Binding Settings.VizFftRiseLow}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="How quickly bass FFT bins rise to new peaks. Higher = snappier bass attack. Default: 88"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <!-- FFT Rise High (treble attack) -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="FFT Rise (Treble): " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.VizFftRiseHigh}"
                                   VerticalAlignment="Center"
                                   Width="30"/>
                        <Slider Minimum="0" Maximum="95"
                                Value="{Binding Settings.VizFftRiseHigh}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="How quickly treble FFT bins rise to new peaks. Higher = snappier treble attack. Default: 93"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <!-- FFT Fall Low (bass decay) -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="FFT Fall (Bass): " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.VizFftFallLow}"
                                   VerticalAlignment="Center"
                                   Width="30"/>
                        <Slider Minimum="0" Maximum="95"
                                Value="{Binding Settings.VizFftFallLow}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="How quickly bass FFT bins decay after energy drops. Lower = smoother bass trailing. Default: 50"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <!-- FFT Fall High (treble decay) -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.ShowSpectrumVisualizer}">
                        <TextBlock Text="FFT Fall (Treble): " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.VizFftFallHigh}"
                                   VerticalAlignment="Center"
                                   Width="30"/>
                        <Slider Minimum="0" Maximum="95"
                                Value="{Binding Settings.VizFftFallHigh}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="How quickly treble FFT bins decay after energy drops. Lower = smoother treble trailing. Default: 65"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <Separator Margin="0,5,0,10"/>

                    <!-- Reset Visualizer Defaults button -->
                    <Button Content="Reset Visualizer to Defaults"
                            Click="ResetVisualizerDefaults_Click"
                            HorizontalAlignment="Left"
                            Padding="15,5"
                            Margin="0,0,0,15"/>
                    <TextBlock Text="Resets all visualizer tuning parameters above to their hardcoded defaults."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,15"/>

                        </StackPanel>
                    </Expander>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Audio Editing Tab -->
        <TabItem Header="Audio Editing">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel Margin="20">
                    <TextBlock Text="Audio Editing" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>
                    <TextBlock Text="Normalize volume levels and trim audio files. Operations are performed on-demand — not in real-time during playback."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <TextBlock Text="Normalization requires processing each file twice (analysis + application), which can be CPU-intensive for large libraries. Use bulk operations below to normalize files when needed."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <!-- FFmpeg Path Setting -->
                    <TextBlock Text="FFmpeg Configuration" FontSize="14" FontWeight="SemiBold" Margin="0,10,0,10"/>
                    <StackPanel Orientation="Horizontal" Margin="0,5">
                        <TextBlock Text="FFmpeg Path: " VerticalAlignment="Center" Width="120"/>
                        <TextBox Text="{Binding Settings.FFmpegPath}"
                                 Width="300"
                                 Margin="0,0,10,0"
                                 IsReadOnly="False"/>
                        <Button Content="Browse..."
                                Width="80"
                                Command="{Binding BrowseForFFmpegFile}"/>
                    </StackPanel>
                    <TextBlock Text="FFmpeg is required for audio normalization, silence trimming, precise trim, and audio repair features. Download from ffmpeg.org if not installed."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,20"/>

                    <StackPanel>
                        <TextBlock Text="Normalization Settings" FontSize="14" FontWeight="SemiBold" Margin="0,20,0,10"/>
                        
                        <StackPanel Orientation="Horizontal" Margin="0,5">
                            <TextBlock Text="Target Loudness: " VerticalAlignment="Center" Width="150"/>
                            <TextBox Text="{Binding Settings.NormalizationTargetLoudness}" 
                                     Width="60" 
                                     Margin="0,0,10,0"/>
                            <TextBlock Text="LUFS (EBU R128: -16 LUFS)" 
                                       VerticalAlignment="Center" 
                                       FontSize="11" 
                                       Foreground="Gray"/>
                        </StackPanel>
                        <TextBlock Text="Target integrated loudness. Industry standard is -16 LUFS. Range: -30 to -10 LUFS" 
                                   FontSize="11" 
                                   Foreground="Gray" 
                                   TextWrapping="Wrap"
                                   Margin="20,0,0,5"/>

                        <StackPanel Orientation="Horizontal" Margin="0,5">
                            <TextBlock Text="True Peak Limit: " VerticalAlignment="Center" Width="150"/>
                            <TextBox Text="{Binding Settings.NormalizationTruePeak}" 
                                     Width="60" 
                                     Margin="0,0,10,0"/>
                            <TextBlock Text="dBTP (EBU R128: -1.5 dBTP)" 
                                       VerticalAlignment="Center" 
                                       FontSize="11" 
                                       Foreground="Gray"/>
                        </StackPanel>
                        <TextBlock Text="True peak limit to prevent clipping. Industry standard is -1.5 dBTP. Range: -3.0 to 0.0 dBTP" 
                                   FontSize="11" 
                                   Foreground="Gray" 
                                   TextWrapping="Wrap"
                                   Margin="20,0,0,5"/>

                        <StackPanel Orientation="Horizontal" Margin="0,5">
                            <TextBlock Text="Loudness Range: " VerticalAlignment="Center" Width="150"/>
                            <TextBox Text="{Binding Settings.NormalizationLoudnessRange}" 
                                     Width="60" 
                                     Margin="0,0,10,0"/>
                            <TextBlock Text="LU (EBU R128: 11 LU)" 
                                       VerticalAlignment="Center" 
                                       FontSize="11" 
                                       Foreground="Gray"/>
                        </StackPanel>
                        <TextBlock Text="Loudness range target. Industry standard is 11 LU. Range: 1 to 20 LU" 
                                   FontSize="11" 
                                   Foreground="Gray" 
                                   TextWrapping="Wrap"
                                   Margin="20,0,0,5"/>

                        <StackPanel Orientation="Horizontal" Margin="0,5">
                            <TextBlock Text="Audio Codec: " VerticalAlignment="Center" Width="150"/>
                            <TextBox Text="{Binding Settings.NormalizationCodec}" 
                                     Width="120" 
                                     Margin="0,0,10,0"/>
                        </StackPanel>
                        <TextBlock Text="Audio codec for output files (default: libmp3lame for MP3)" 
                                   FontSize="11" 
                                   Foreground="Gray" 
                                   TextWrapping="Wrap"
                                   Margin="20,0,0,10"/>

                        <TextBlock Text="File Naming" FontSize="14" FontWeight="SemiBold" Margin="0,10,0,10"/>
                        <TextBlock Text="Normalized files are always created with a suffix (e.g., 'song-normalized.mp3'), preserving your original files. Original files are never modified or deleted." 
                                   FontSize="11" 
                                   Foreground="Gray" 
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,10"/>

                        <StackPanel Orientation="Horizontal" Margin="0,5">
                            <TextBlock Text="Normalization Suffix: " VerticalAlignment="Center" Width="150"/>
                            <TextBox Text="{Binding Settings.NormalizationSuffix}"
                                     Width="120"
                                     Margin="0,0,10,0"/>
                        </StackPanel>
                        <TextBlock Text="Suffix to append to normalized file names (default: '-normalized'). Example: 'song.mp3' becomes 'song-normalized.mp3'"
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"
                                   Margin="20,0,0,10"/>

                        <StackPanel Orientation="Horizontal" Margin="0,5">
                            <TextBlock Text="Silence Trim Suffix: " VerticalAlignment="Center" Width="150"/>
                            <TextBox Text="{Binding Settings.TrimSuffix}"
                                     Width="120"
                                     Margin="0,0,10,0"/>
                        </StackPanel>
                        <TextBlock Text="Suffix to append to silence-trimmed file names (default: '-trimmed'). Example: 'song.mp3' becomes 'song-trimmed.mp3'"
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"
                                   Margin="20,0,0,10"/>

                        <CheckBox Content="Skip Already Normalized Files" 
                                  IsChecked="{Binding Settings.SkipAlreadyNormalized}" 
                                  Margin="0,10"/>
                        <TextBlock Text="When enabled, files with the normalization suffix are automatically skipped during bulk operations. Useful when downloading new music." 
                                   FontSize="11" 
                                   Foreground="Gray" 
                                   TextWrapping="Wrap"
                                   Margin="20,0,0,10"/>

                        <CheckBox Content="Do not preserve originals (space saver)" 
                                  IsChecked="{Binding Settings.DoNotPreserveOriginals}" 
                                  Margin="0,10"/>
                        <TextBlock Text="When enabled, original files are normalized directly and replaced (no backup/preservation). Saves disk space but originals cannot be restored. When disabled, originals are moved to PreservedOriginals folder." 
                                   FontSize="11" 
                                   Foreground="#FFA500"
                                   FontWeight="SemiBold"
                                   TextWrapping="Wrap"
                                   Margin="20,0,0,20"/>

                        <Separator Margin="0,10"/>

                        <TextBlock Text="Bulk Actions" FontSize="14" FontWeight="SemiBold" Margin="0,10,0,10"/>

                        <StackPanel Orientation="Horizontal" Margin="0,5">
                            <Button Content="Normalize All Music Files"
                                    Width="220"
                                    Margin="0,0,10,0"
                                    Command="{Binding NormalizeAllMusicCommand}"/>
                            <TextBlock Text="Normalize all music in your library to consistent volume."
                                       VerticalAlignment="Center"
                                       FontSize="11"
                                       Foreground="Gray"
                                       TextWrapping="Wrap"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,10">
                            <Button Content="Trim Silence - All Files"
                                    Width="220"
                                    Margin="0,0,10,0"
                                    Command="{Binding TrimAllMusicCommand}"/>
                            <TextBlock Text="Remove leading silence from all music files."
                                       VerticalAlignment="Center"
                                       FontSize="11"
                                       Foreground="Gray"
                                       TextWrapping="Wrap"/>
                        </StackPanel>

                        <Separator Margin="0,15"/>

                        <TextBlock Text="Original File Management" FontSize="14" FontWeight="SemiBold" Margin="0,10,0,10"/>

                        <StackPanel Orientation="Horizontal" Margin="0,5">
                            <Button Content="Open Preserved Folder"
                                    Width="220"
                                    Margin="0,0,10,0"
                                    Command="{Binding OpenPreservedOriginalsFolderCommand}"/>
                            <TextBlock Text="Open the folder containing backup copies of original files."
                                       VerticalAlignment="Center"
                                       FontSize="11"
                                       Foreground="Gray"
                                       TextWrapping="Wrap"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,10">
                            <Button Content="Restore Original Files"
                                    Width="220"
                                    Margin="0,0,10,0"
                                    Command="{Binding RestoreNormalizedFilesCommand}"/>
                            <TextBlock Text="Restore originals and delete normalized/trimmed versions."
                                       VerticalAlignment="Center"
                                       FontSize="11"
                                       Foreground="Gray"
                                       TextWrapping="Wrap"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,10">
                            <Button Content="Delete Preserved Originals"
                                    Width="220"
                                    Margin="0,0,10,0"
                                    Command="{Binding DeletePreservedOriginalsCommand}"/>
                            <TextBlock Text="Permanently delete all preserved originals to free disk space."
                                       VerticalAlignment="Center"
                                       FontSize="11"
                                       Foreground="#FF6B6B"
                                       FontWeight="SemiBold"
                                       TextWrapping="Wrap"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Downloads Tab -->
        <TabItem Header="Downloads">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel Margin="20">
                    <TextBlock Text="Download Settings" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>
                    <TextBlock Text="Configure download tools and auto-download behavior" FontSize="11" Foreground="Gray" Margin="0,0,0,20"/>

                    <StackPanel Orientation="Horizontal" Margin="0,5">
                        <TextBlock Text="yt-dlp Path: " VerticalAlignment="Center" Width="120"/>
                        <TextBox Text="{Binding Settings.YtDlpPath}"
                                 Width="300"
                                 Margin="0,0,10,0"
                                 IsReadOnly="False"/>
                        <Button Content="Browse..."
                                Width="80"
                                Command="{Binding BrowseForYtDlpFile}"/>
                    </StackPanel>

                    <Separator Margin="0,10"/>

                    <CheckBox Content="Use cookies from browser (Firefox)"
                              IsChecked="{Binding Settings.UseFirefoxCookies}"
                              Margin="0,10,0,5"/>
                    <TextBlock Text="When enabled, uses Firefox cookies for YouTube downloads. This helps bypass bot detection and improves download reliability. Make sure Firefox is installed and you're logged into YouTube in Firefox."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <Separator Margin="0,15"/>

                    <TextBlock Text="Post-Download Processing" FontSize="14" FontWeight="SemiBold" Margin="0,10,0,10"/>

                    <CheckBox Content="Automatically normalize downloaded music"
                              IsChecked="{Binding Settings.AutoNormalizeAfterDownload}"
                              Margin="0,10,0,5"/>
                    <TextBlock Text="When enabled, music files will be automatically normalized to EBU R128 standard after downloading. Uses the normalization settings configured in the Audio Editing tab. Requires FFmpeg."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <Separator Margin="0,15"/>

                    <TextBlock Text="Auto-Download on Library Update" FontSize="14" FontWeight="SemiBold" Margin="0,10,0,10"/>

                    <CheckBox Content="Automatically download music for new games"
                              IsChecked="{Binding Settings.AutoDownloadOnLibraryUpdate}"
                              Margin="0,10,0,5"/>
                    <TextBlock Text="When enabled, music will be automatically downloaded for newly added games when your library is updated. Uses intelligent album and song selection to find the best match (title/main theme preferred). Only 1 song per game is downloaded. Requires yt-dlp and FFmpeg to be configured."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <Separator Margin="0,15"/>

                    <TextBlock Text="Bulk Download" FontSize="14" FontWeight="SemiBold" Margin="0,10,0,10"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10">
                        <Button Content="Download Music for All Games"
                                Width="220"
                                Margin="0,0,10,0"
                                Command="{Binding DownloadMusicForAllGamesCommand}"/>
                        <TextBlock Text="Download music for all games that don't have any yet."
                                   VerticalAlignment="Center"
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                    <TextBlock Text="Use this to populate music for your existing game library. Shows progress and can be cancelled."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Search Tab -->
        <TabItem Header="Search">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel Margin="20">
                    <TextBlock Text="Search Settings" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>
                    <TextBlock Text="Manage search result caching and the auto-search hints database" FontSize="11" Foreground="Gray" Margin="0,0,0,20"/>

                    <CheckBox Content="Enable Search Result Caching"
                              IsChecked="{Binding Settings.EnableSearchCache}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, caches search results from KHInsider and YouTube to avoid redundant searches. Cached results expire after the specified duration."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.EnableSearchCache}">
                        <TextBlock Text="Cache Duration (days): " VerticalAlignment="Center" Width="150"/>
                        <TextBox Text="{Binding Settings.SearchCacheDurationDays}"
                                 Width="60"
                                 Margin="0,0,10,0"/>
                        <TextBlock Text="(1-30 days)"
                                   VerticalAlignment="Center"
                                   FontSize="11"
                                   Foreground="Gray"/>
                    </StackPanel>
                    <TextBlock Text="How long to keep cached search results before they expire. Longer duration = fewer searches but may miss new uploads."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10">
                        <Button Content="Clear Search Cache"
                                Width="150"
                                Command="{Binding ClearSearchCache}"/>
                        <TextBlock Text="{Binding CacheStatsText}"
                                   VerticalAlignment="Center"
                                   Margin="15,0,0,0"
                                   FontSize="11"
                                   Foreground="Gray"/>
                    </StackPanel>

                    <Separator Margin="0,20"/>

                    <!-- Auto-Search Hint Override Section -->
                    <TextBlock Text="Auto-Search Hint Database" FontSize="14" FontWeight="SemiBold" Margin="0,10,0,10"/>
                    <TextBlock Text="Download and update the search hints database from GitHub. This database helps auto-download find correct soundtracks for games with problematic names."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,15"/>

                    <StackPanel Orientation="Horizontal" Margin="0,5">
                        <TextBlock Text="Status: " VerticalAlignment="Center" FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding HintsDatabaseStatus}"
                                   VerticalAlignment="Center"
                                   Foreground="#90CAF9"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,15,0,5">
                        <Button Content="Download GitHub File"
                                Width="170"
                                Command="{Binding DownloadHintsFromGitHub}"
                                Background="#5E35B1"
                                Foreground="White"/>
                        <Button Content="Open Database Folder"
                                Width="160"
                                Margin="10,0,0,0"
                                Command="{Binding OpenHintsDatabaseFolder}"/>
                    </StackPanel>
                    <TextBlock Text="Downloads the latest search_hints.json from the UniPlaySong GitHub repository. The downloaded file will be used instead of the bundled version."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,5,0,0"/>

                    <StackPanel Orientation="Horizontal" Margin="0,15,0,5">
                        <Button Content="Revert to Bundled"
                                Width="160"
                                Command="{Binding RevertToBundledHints}"
                                IsEnabled="{Binding HasDownloadedHints}"/>
                    </StackPanel>
                    <TextBlock Text="Delete the downloaded database and use the version bundled with the extension."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,5,0,0"/>

                    <CheckBox Content="Check for updates on startup"
                              IsChecked="{Binding Settings.AutoCheckHintsOnStartup}"
                              Margin="0,15,0,5"/>
                    <TextBlock Text="Automatically check if a newer search hints database is available on GitHub when Playnite starts. You will be notified if updates are available."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,0"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Migration Tab -->
        <TabItem Header="Migration">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel Margin="20">
                    <TextBlock Text="Music Migration" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>
                    <TextBlock Text="Transfer music files between PlayniteSound and UniPlaySong extensions."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <TextBlock Text="Note: Only audio files will be migrated. Metadata files (.json) are not transferred. Files are copied, not moved - originals remain in place."
                               FontSize="11"
                               Foreground="#FFA500"
                               FontWeight="SemiBold"
                               TextWrapping="Wrap"
                               Margin="0,0,0,20"/>

                    <!-- Migration Summary -->
                    <Border Background="#2D2D2D" CornerRadius="4" Padding="15" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Current Status" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="PlayniteSound" FontWeight="SemiBold" Margin="0,0,0,5"/>
                                    <TextBlock Text="{Binding MigrationPlayniteSoundStatus}"
                                               FontSize="11"
                                               Foreground="Gray"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="UniPlaySong" FontWeight="SemiBold" Margin="0,0,0,5"/>
                                    <TextBlock Text="{Binding MigrationUniPlaySongStatus}"
                                               FontSize="11"
                                               Foreground="Gray"/>
                                </StackPanel>
                            </Grid>
                            <Button Content="Refresh Status"
                                    HorizontalAlignment="Left"
                                    Margin="0,10,0,0"
                                    Padding="10,5"
                                    Command="{Binding RefreshMigrationStatusCommand}"/>
                        </StackPanel>
                    </Border>

                    <Separator Margin="0,0,0,20"/>

                    <!-- Import from PlayniteSound -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock Text="Import from PlayniteSound" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock Text="Copy music files from PlayniteSound to UniPlaySong. Use this if you're switching from PlayniteSound to UniPlaySong."
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,10"/>
                        <Button Content="Import from PlayniteSound"
                                Command="{Binding MigrateFromPlayniteSoundCommand}"
                                Padding="15,8"
                                HorizontalAlignment="Left"/>
                    </StackPanel>

                    <Separator Margin="0,0,0,20"/>

                    <!-- Import from PlayniteSound & Delete -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock Text="Import from PlayniteSound &amp; Delete" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock Text="Import all music from PlayniteSound to UniPlaySong, then DELETE the original PlayniteSound files. Use this for a clean migration when you no longer need PlayniteSound."
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,5"/>
                        <TextBlock Text="WARNING: Original PlayniteSound music files will be permanently deleted after import!"
                                   FontSize="11"
                                   Foreground="#FF6666"
                                   FontWeight="SemiBold"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,10"/>
                        <Button Content="Import &amp; Delete PlayniteSound Music"
                                Command="{Binding MigrateFromPlayniteSoundAndDeleteCommand}"
                                Padding="15,8"
                                HorizontalAlignment="Left"
                                Background="#664422"
                                Foreground="White"/>
                    </StackPanel>

                    <Separator Margin="0,0,0,20"/>

                    <!-- Export to PlayniteSound -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock Text="Export to PlayniteSound" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock Text="Copy music files from UniPlaySong to PlayniteSound. Use this if you want to share your music library with PlayniteSound users or switch back."
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,10"/>
                        <Button Content="Export to PlayniteSound"
                                Command="{Binding MigrateToPlayniteSoundCommand}"
                                Padding="15,8"
                                HorizontalAlignment="Left"/>
                    </StackPanel>

                    <Separator Margin="0,0,0,20"/>

                    <!-- Directory Info -->
                    <StackPanel>
                        <TextBlock Text="Directory Locations" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="0,0,0,5">
                            <Run FontWeight="SemiBold">PlayniteSound:</Run>
                            <Run Text=" %APPDATA%\Playnite\ExtraMetadata\Games\{GameId}\Music Files\"/>
                        </TextBlock>
                        <TextBlock FontSize="11" Foreground="Gray" TextWrapping="Wrap">
                            <Run FontWeight="SemiBold">UniPlaySong:</Run>
                            <Run Text=" %APPDATA%\Playnite\ExtraMetadata\UniPlaySong\Games\{GameId}\"/>
                        </TextBlock>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Toast Notifications Tab (Hidden - keep code for future editing) -->
        <TabItem Header="Toast Notifications" Visibility="Collapsed">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel Margin="20">
                    <TextBlock Text="Toast Notification Settings" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>
                    <TextBlock Text="Customize the appearance and behavior of toast notifications shown in fullscreen/controller mode."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,20"/>

                    <!-- Test Toast Button -->
                    <Border Background="#2D2D2D" CornerRadius="4" Padding="15" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Preview" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                            <TextBlock Text="Test the current toast settings to see how they look."
                                       FontSize="11"
                                       Foreground="Gray"
                                       Margin="0,0,0,10"/>
                            <StackPanel Orientation="Horizontal">
                                <Button Content="Show Test Toast"
                                        Width="140"
                                        Margin="0,0,10,0"
                                        Command="{Binding ShowTestToastCommand}"/>
                                <Button Content="Show Error Toast"
                                        Width="140"
                                        Command="{Binding ShowTestErrorToastCommand}"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <Separator Margin="0,0,0,20"/>

                    <!-- Blur Effect Settings -->
                    <TextBlock Text="Blur Effect" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                    <TextBlock Text="Acrylic blur effect creates a frosted glass appearance. Requires Windows 10 1803 or later."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <CheckBox Content="Enable Acrylic Blur Effect"
                              IsChecked="{Binding Settings.EnableToastAcrylicBlur}"
                              Margin="0,5"/>

                    <!-- Blur Opacity -->
                    <StackPanel Orientation="Horizontal" Margin="0,15,0,5">
                        <TextBlock Text="Blur Opacity: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ToastBlurOpacity}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <Slider Minimum="0" Maximum="255"
                                Value="{Binding Settings.ToastBlurOpacity}"
                                Width="200"
                                SmallChange="5"
                                LargeChange="20"
                                TickFrequency="32"
                                TickPlacement="BottomRight"
                                Margin="10,0,0,0"/>
                    </StackPanel>
                    <TextBlock Text="Higher = more opaque/darker. Lower = more transparent (more blur visible). 0 = fully transparent. Default: 221"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Blur Mode -->
                    <StackPanel Orientation="Horizontal" Margin="0,15,0,5">
                        <TextBlock Text="Blur Mode: " VerticalAlignment="Center" Width="120"/>
                        <ComboBox SelectedIndex="{Binding Settings.ToastBlurMode}" Width="200">
                            <ComboBoxItem Content="Basic Blur (Less Intense)"/>
                            <ComboBoxItem Content="Acrylic Blur (More Intense)"/>
                        </ComboBox>
                    </StackPanel>
                    <TextBlock Text="Acrylic blur has a frosted glass effect with noise texture and supports tint color. Basic blur is smoother but does NOT support tint color (Windows API limitation)."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,15"/>

                    <Separator Margin="0,10,0,15"/>

                    <!-- Blur Tint Color Section (Acrylic mode only) -->
                    <TextBlock Text="Tint Color (Acrylic Mode Only)" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>

                    <!-- Color Preview and Hex Input -->
                    <StackPanel Orientation="Horizontal" Margin="0,5,0,10">
                        <TextBlock Text="Color: " VerticalAlignment="Center" Width="120"/>
                        <Border Width="40" Height="24" CornerRadius="4" BorderBrush="#555" BorderThickness="1" Margin="0,0,10,0"
                                VerticalAlignment="Center"
                                Background="{Binding Settings.ToastBlurTintColor, Converter={StaticResource HexToColorConverter}}"/>
                        <TextBlock Text="#" VerticalAlignment="Center"/>
                        <TextBox Text="{Binding Settings.ToastBlurTintColor, UpdateSourceTrigger=PropertyChanged}"
                                 Width="80"
                                 MaxLength="6"
                                 VerticalContentAlignment="Center"/>
                    </StackPanel>

                    <!-- Quick Color Presets -->
                    <StackPanel Orientation="Horizontal" Margin="0,5,0,15">
                        <TextBlock Text="Presets: " VerticalAlignment="Center" Width="120"/>
                        <Button Content="Dark" Width="50" Margin="0,0,5,0" Padding="5,2"
                                Command="{Binding SetToastColorCommand}" CommandParameter="1E1E1E"
                                ToolTip="Dark gray (#1E1E1E)"/>
                        <Button Content="Black" Width="50" Margin="0,0,5,0" Padding="5,2"
                                Command="{Binding SetToastColorCommand}" CommandParameter="000000"
                                ToolTip="Pure black (#000000)"/>
                        <Button Content="Blue" Width="50" Margin="0,0,5,0" Padding="5,2"
                                Command="{Binding SetToastColorCommand}" CommandParameter="1A237E"
                                ToolTip="Dark blue (#1A237E)"/>
                        <Button Content="Purple" Width="50" Margin="0,0,5,0" Padding="5,2"
                                Command="{Binding SetToastColorCommand}" CommandParameter="4A148C"
                                ToolTip="Dark purple (#4A148C)"/>
                        <Button Content="Green" Width="50" Margin="0,0,5,0" Padding="5,2"
                                Command="{Binding SetToastColorCommand}" CommandParameter="1B5E20"
                                ToolTip="Dark green (#1B5E20)"/>
                        <Button Content="Red" Width="50" Padding="5,2"
                                Command="{Binding SetToastColorCommand}" CommandParameter="B71C1C"
                                ToolTip="Dark red (#B71C1C)"/>
                    </StackPanel>

                    <!-- RGB Sliders with Brightness -->
                    <Border Background="#2D2D2D" CornerRadius="4" Padding="15" Margin="0,0,0,15">
                        <StackPanel>
                            <TextBlock Text="RGB Color Mixer" FontSize="12" FontWeight="SemiBold" Margin="0,0,0,10"/>

                            <!-- Brightness -->
                            <StackPanel Orientation="Horizontal" Margin="0,5,0,10">
                                <TextBlock Text="Brightness:" VerticalAlignment="Center" Width="70" Foreground="#FFD93D"/>
                                <Button Content="-" Width="30" Margin="0,0,5,0" Padding="5,2"
                                        Command="{Binding AdjustBrightnessCommand}" CommandParameter="-20"
                                        ToolTip="Darken color"/>
                                <Button Content="--" Width="30" Margin="0,0,10,0" Padding="5,2"
                                        Command="{Binding AdjustBrightnessCommand}" CommandParameter="-50"
                                        ToolTip="Darken more"/>
                                <Button Content="+" Width="30" Margin="0,0,5,0" Padding="5,2"
                                        Command="{Binding AdjustBrightnessCommand}" CommandParameter="20"
                                        ToolTip="Lighten color"/>
                                <Button Content="++" Width="30" Padding="5,2"
                                        Command="{Binding AdjustBrightnessCommand}" CommandParameter="50"
                                        ToolTip="Lighten more"/>
                            </StackPanel>

                            <!-- Red -->
                            <StackPanel Orientation="Horizontal" Margin="0,5,0,5">
                                <TextBlock Text="R:" VerticalAlignment="Center" Width="25" Foreground="#FF6B6B"/>
                                <TextBlock Text="{Binding ToastColorRed}" VerticalAlignment="Center" Width="35"/>
                                <Slider Minimum="0" Maximum="255"
                                        Value="{Binding ToastColorRed}"
                                        Width="200"
                                        SmallChange="1"
                                        LargeChange="16"/>
                            </StackPanel>

                            <!-- Green -->
                            <StackPanel Orientation="Horizontal" Margin="0,5,0,5">
                                <TextBlock Text="G:" VerticalAlignment="Center" Width="25" Foreground="#69DB7C"/>
                                <TextBlock Text="{Binding ToastColorGreen}" VerticalAlignment="Center" Width="35"/>
                                <Slider Minimum="0" Maximum="255"
                                        Value="{Binding ToastColorGreen}"
                                        Width="200"
                                        SmallChange="1"
                                        LargeChange="16"/>
                            </StackPanel>

                            <!-- Blue -->
                            <StackPanel Orientation="Horizontal" Margin="0,5,0,5">
                                <TextBlock Text="B:" VerticalAlignment="Center" Width="25" Foreground="#74C0FC"/>
                                <TextBlock Text="{Binding ToastColorBlue}" VerticalAlignment="Center" Width="35"/>
                                <Slider Minimum="0" Maximum="255"
                                        Value="{Binding ToastColorBlue}"
                                        Width="200"
                                        SmallChange="1"
                                        LargeChange="16"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <TextBlock Text="Use the RGB sliders, brightness buttons, or presets to pick a tint color. Only works with Acrylic blur mode."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,15"/>

                    <Separator Margin="0,10"/>

                    <!-- Size Settings -->
                    <TextBlock Text="Size &amp; Position" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>

                    <!-- Width -->
                    <StackPanel Orientation="Horizontal" Margin="0,10,0,5">
                        <TextBlock Text="Width: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ToastWidth, StringFormat='{}{0:F0}'}"
                                   VerticalAlignment="Center"
                                   Width="40"/>
                        <TextBlock Text="px" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="200" Maximum="800"
                                Value="{Binding Settings.ToastWidth}"
                                Width="200"
                                SmallChange="10"
                                LargeChange="50"
                                TickFrequency="100"
                                TickPlacement="BottomRight"/>
                    </StackPanel>

                    <!-- Min Height -->
                    <StackPanel Orientation="Horizontal" Margin="0,10,0,5">
                        <TextBlock Text="Min Height: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ToastMinHeight, StringFormat='{}{0:F0}'}"
                                   VerticalAlignment="Center"
                                   Width="40"/>
                        <TextBlock Text="px" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="50" Maximum="200"
                                Value="{Binding Settings.ToastMinHeight}"
                                Width="200"
                                SmallChange="5"
                                LargeChange="20"
                                TickFrequency="25"
                                TickPlacement="BottomRight"/>
                    </StackPanel>

                    <!-- Max Height -->
                    <StackPanel Orientation="Horizontal" Margin="0,10,0,5">
                        <TextBlock Text="Max Height: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ToastMaxHeight, StringFormat='{}{0:F0}'}"
                                   VerticalAlignment="Center"
                                   Width="40"/>
                        <TextBlock Text="px" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="100" Maximum="400"
                                Value="{Binding Settings.ToastMaxHeight}"
                                Width="200"
                                SmallChange="10"
                                LargeChange="50"
                                TickFrequency="50"
                                TickPlacement="BottomRight"/>
                    </StackPanel>

                    <!-- Corner Radius -->
                    <StackPanel Orientation="Horizontal" Margin="0,10,0,5">
                        <TextBlock Text="Corner Radius: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ToastCornerRadius, StringFormat='{}{0:F0}'}"
                                   VerticalAlignment="Center"
                                   Width="40"/>
                        <TextBlock Text="px" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="32"
                                Value="{Binding Settings.ToastCornerRadius}"
                                Width="200"
                                SmallChange="1"
                                LargeChange="4"
                                TickFrequency="4"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="0 = square corners, higher = more rounded. Default: 8"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Edge Margin -->
                    <StackPanel Orientation="Horizontal" Margin="0,10,0,5">
                        <TextBlock Text="Edge Margin: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ToastEdgeMargin}"
                                   VerticalAlignment="Center"
                                   Width="40"/>
                        <TextBlock Text="px" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100"
                                Value="{Binding Settings.ToastEdgeMargin}"
                                Width="200"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Distance from screen edge where toast appears. Default: 30"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,15"/>

                    <Separator Margin="0,10"/>

                    <!-- Timing Settings -->
                    <TextBlock Text="Timing" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>

                    <!-- Duration -->
                    <StackPanel Orientation="Horizontal" Margin="0,10,0,5">
                        <TextBlock Text="Duration: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ToastDurationMs, StringFormat='{}{0:F0}'}"
                                   VerticalAlignment="Center"
                                   Width="50"/>
                        <TextBlock Text="ms" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="1000" Maximum="10000"
                                Value="{Binding Settings.ToastDurationMs}"
                                Width="200"
                                SmallChange="250"
                                LargeChange="1000"
                                TickFrequency="1000"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="How long the toast stays on screen (in milliseconds). 1000 = 1 second. Default: 4000 (4 seconds)"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,15"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Cleanup Tab -->
        <TabItem Header="Cleanup">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel Margin="20">
                    <TextBlock Text="Cleanup &amp; Reset" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>
                    <TextBlock Text="Reset UniPlaySong settings and remove all downloaded content."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,20"/>

                    <!-- Warning Banner -->
                    <Border Background="#4A1A1A" BorderBrush="#FF4444" BorderThickness="1" CornerRadius="4" Padding="15" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="WARNING: These actions cannot be undone!"
                                       FontSize="14"
                                       FontWeight="Bold"
                                       Foreground="#FF6666"
                                       Margin="0,0,0,5"/>
                            <TextBlock Text="Factory Reset will permanently delete all downloaded music files, preserved originals, and reset all settings to their defaults. Make sure you have backups if needed."
                                       FontSize="11"
                                       Foreground="#FFAAAA"
                                       TextWrapping="Wrap"/>
                        </StackPanel>
                    </Border>

                    <!-- Current Storage Info -->
                    <Border Background="#2D2D2D" CornerRadius="4" Padding="15" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Current Storage Usage" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                            <TextBlock Text="{Binding CleanupStorageInfo}"
                                       FontSize="11"
                                       Foreground="Gray"
                                       TextWrapping="Wrap"/>
                            <Button Content="Refresh"
                                    HorizontalAlignment="Left"
                                    Margin="0,10,0,0"
                                    Padding="10,5"
                                    Command="{Binding RefreshCleanupStorageInfoCommand}"/>
                        </StackPanel>
                    </Border>

                    <Separator Margin="0,0,0,20"/>

                    <!-- Delete All Music -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock Text="Delete All Music" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock Text="Removes all downloaded music files and game folders. Settings will be preserved."
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,10"/>
                        <Button Content="Delete All Music Files"
                                Command="{Binding DeleteAllMusicCommand}"
                                Padding="15,8"
                                HorizontalAlignment="Left"
                                Background="#882222"
                                Foreground="White"/>
                    </StackPanel>

                    <Separator Margin="0,0,0,20"/>

                    <!-- Delete Long Songs -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock Text="Delete Long Songs" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock Text="Scans your music library and deletes songs longer than 10 minutes. Useful for removing accidentally downloaded full albums, podcasts, or corrupted files that break bulk operations."
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,10"/>
                        <Button Content="Delete Songs &gt; 10 Minutes"
                                Command="{Binding DeleteLongSongsCommand}"
                                Padding="15,8"
                                HorizontalAlignment="Left"
                                Background="#664422"
                                Foreground="White"/>
                    </StackPanel>

                    <Separator Margin="0,0,0,20"/>

                    <!-- Clean Up Orphaned Music -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock Text="Clean Up Orphaned Music" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock Text="Scans for music folders belonging to games that are no longer in your Playnite library and removes them."
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,10"/>
                        <CheckBox Content="Automatically delete music when games are removed from library"
                                  IsChecked="{Binding Settings.AutoDeleteMusicOnGameRemoval}"
                                  Margin="0,0,0,10"/>
                        <Button Content="Clean Up Orphaned Music"
                                Command="{Binding CleanupOrphanedMusicCommand}"
                                Padding="15,8"
                                HorizontalAlignment="Left"
                                Background="#664422"
                                Foreground="White"/>
                    </StackPanel>

                    <Separator Margin="0,0,0,20"/>

                    <!-- Reset Settings Only -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock Text="Reset Settings Only" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock Text="Resets all settings to their default values. Music files will be preserved."
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,10"/>
                        <Button Content="Reset Settings to Defaults"
                                Command="{Binding ResetSettingsCommand}"
                                Padding="15,8"
                                HorizontalAlignment="Left"/>
                    </StackPanel>

                    <Separator Margin="0,0,0,20"/>

                    <!-- Factory Reset -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock Text="Factory Reset" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock Text="Completely resets UniPlaySong to its initial state. This will:"
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,5"/>
                        <TextBlock FontSize="11" Foreground="Gray" Margin="10,0,0,10">
                            <Run Text="- Delete all downloaded music files"/>
                            <LineBreak/>
                            <Run Text="- Delete all preserved original files"/>
                            <LineBreak/>
                            <Run Text="- Remove all game music folders"/>
                            <LineBreak/>
                            <Run Text="- Clear the search cache"/>
                            <LineBreak/>
                            <Run Text="- Reset all settings to defaults"/>
                        </TextBlock>
                        <Button Content="Factory Reset"
                                Command="{Binding FactoryResetCommand}"
                                Padding="15,8"
                                HorizontalAlignment="Left"
                                Background="#AA2222"
                                Foreground="White"
                                FontWeight="Bold"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </TabItem>
    </TabControl>
</UserControl>