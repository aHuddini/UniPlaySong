<UserControl x:Class="UniPlaySong.UniPlaySongSettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:UniPlaySong"
             mc:Ignorable="d"
             d:DesignHeight="500" d:DesignWidth="600">
    <UserControl.Resources>
        <local:AudioStateConverter x:Key="AudioStateConverter"/>
        <local:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
        <local:ReverbPresetConverter x:Key="ReverbPresetConverter"/>
        <local:EffectChainPresetConverter x:Key="EffectChainPresetConverter"/>
    </UserControl.Resources>
    <TabControl>
        <!-- General Tab -->
        <TabItem Header="General">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel Margin="20">
                    <TextBlock Text="General Settings" FontSize="18" FontWeight="Bold" Margin="0,0,0,20"/>
                    
                    <CheckBox Content="Enable Music" 
                              IsChecked="{Binding Settings.EnableMusic}" 
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, music will automatically play when selecting games (console-like preview experience)" 
                               FontSize="11" 
                               Foreground="Gray" 
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>
                    
                    <StackPanel Orientation="Horizontal" Margin="0,10">
                        <TextBlock Text="Play Music State: " VerticalAlignment="Center" Width="150"/>
                        <ComboBox SelectedIndex="{Binding Settings.MusicState, Converter={StaticResource AudioStateConverter}}" 
                                  Width="200" 
                                  Margin="0,0,0,0">
                            <ComboBoxItem Content="Never"/>
                            <ComboBoxItem Content="Desktop"/>
                            <ComboBoxItem Content="Fullscreen"/>
                            <ComboBoxItem Content="Desktop + Fullscreen"/>
                        </ComboBox>
                    </StackPanel>
                    <TextBlock Text="Controls when music plays: Never, Desktop only, Fullscreen only, or Both" 
                               FontSize="11" 
                               Foreground="Gray" 
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>
                    
                    <CheckBox Content="Do not play music on startup" 
                              IsChecked="{Binding Settings.SkipFirstSelectionAfterModeSwitch}" 
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, music will not play on the first game selection after switching to fullscreen mode" 
                               FontSize="11" 
                               Foreground="Gray" 
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>
                    
                    <CheckBox Content="Theme Compatible Login Skip"
                              IsChecked="{Binding Settings.ThemeCompatibleSilentSkip}"
                              IsEnabled="{Binding Settings.IsThemeCompatibleSilentSkipEnabled}"
                              Margin="0,5"/>
                    <TextBlock Text="Waits for keyboard or controller input (Enter/Space/Escape/Return) before playing music. When enabled, music will not play until you press a key to dismiss the login screen. Useful for fullscreen themes with login/welcome screens."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <CheckBox Content="Pause music when Playnite loses focus"
                              IsChecked="{Binding Settings.PauseOnFocusLoss}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, music will pause when you switch to another application. Music will resume when Playnite regains focus."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <CheckBox Content="Pause music when Playnite is minimized"
                              IsChecked="{Binding Settings.PauseOnMinimize}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, music will pause when Playnite is minimized to the taskbar. Music will resume when Playnite is restored."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <CheckBox Content="Pause music when Playnite is in system tray"
                              IsChecked="{Binding Settings.PauseWhenInSystemTray}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, music will pause when Playnite is hidden in the system tray (e.g., on startup or after closing to tray). Music will resume when Playnite is restored."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <Separator Margin="0,10"/>
                    
                    <!-- Volume -->
                    <StackPanel Orientation="Horizontal" Margin="0,10">
                        <TextBlock Text="Music Volume: " VerticalAlignment="Center" Width="120"/>
                        <Slider Minimum="0" Maximum="100" 
                                Value="{Binding Settings.MusicVolume}" 
                                Width="200" Margin="0,0,10,0"/>
                        <TextBlock Text="{Binding Settings.MusicVolume}" 
                                   VerticalAlignment="Center" 
                                   Width="30"/>
                    </StackPanel>

                    <!-- Fade In Duration -->
                    <StackPanel Orientation="Horizontal" Margin="0,10">
                        <TextBlock Text="Fade-In Duration: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.FadeInDuration, StringFormat='{}{0:F2}'}" 
                                   VerticalAlignment="Center" 
                                   Width="35"
                                   Margin="0,0,3,0"/>
                        <TextBlock Text="s" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0.05" Maximum="10" 
                                Value="{Binding Settings.FadeInDuration}" 
                                Width="180" 
                                SmallChange="0.05"
                                LargeChange="0.5"
                                TickFrequency="0.5"
                                TickPlacement="BottomRight"
                                AutoToolTipPlacement="TopLeft"
                                AutoToolTipPrecision="2"/>
                    </StackPanel>
                    <TextBlock Text="How long music fades in when starting or resuming (longer = smoother)" 
                               FontSize="11" 
                               Foreground="Gray" 
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>

                    <!-- Fade Out Duration -->
                    <StackPanel Orientation="Horizontal" Margin="0,10">
                        <TextBlock Text="Fade-Out Duration: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.FadeOutDuration, StringFormat='{}{0:F2}'}" 
                                   VerticalAlignment="Center" 
                                   Width="35"
                                   Margin="0,0,3,0"/>
                        <TextBlock Text="s" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0.05" Maximum="10" 
                                Value="{Binding Settings.FadeOutDuration}" 
                                Width="180" 
                                SmallChange="0.05"
                                LargeChange="0.5"
                                TickFrequency="0.5"
                                TickPlacement="BottomRight"
                                AutoToolTipPlacement="TopLeft"
                                AutoToolTipPrecision="2"/>
                    </StackPanel>
                    <TextBlock Text="How long music fades out when switching games or pausing (shorter = snappier)"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <Separator Margin="0,15"/>

                    <!-- Preview Mode -->
                    <TextBlock Text="Preview Mode" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                    <TextBlock Text="Limit playback duration for game-specific music tracks" FontSize="11" Foreground="Gray" Margin="0,0,0,10"/>

                    <CheckBox Content="Enable Preview Mode"
                              IsChecked="{Binding Settings.EnablePreviewMode}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, game music will restart after the specified duration. Great for cycling through long tracks when browsing your library. Does not affect default music."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Preview Duration -->
                    <StackPanel Orientation="Horizontal" Margin="0,10">
                        <TextBlock Text="Preview Duration: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.PreviewDuration}"
                                   VerticalAlignment="Center"
                                   Width="35"
                                   Margin="0,0,3,0"/>
                        <TextBlock Text="s" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="15" Maximum="300"
                                Value="{Binding Settings.PreviewDuration}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="15"
                                TickFrequency="15"
                                TickPlacement="BottomRight"
                                AutoToolTipPlacement="TopLeft"/>
                    </StackPanel>
                    <TextBlock Text="How long each game music track plays before restarting (15-300 seconds)"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Song Randomization -->
                    <TextBlock Text="Song Randomization" FontSize="13" FontWeight="SemiBold" Margin="0,15,0,5"/>
                    <TextBlock Text="Control when songs are randomized during playback" FontSize="11" Foreground="Gray" Margin="0,0,0,10"/>

                    <CheckBox Content="Randomize song upon selection"
                              IsChecked="{Binding Settings.RandomizeOnEverySelect}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, a random song will be selected each time you select a game (after primary song plays). Provides variety when browsing your library."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <CheckBox Content="Randomize song when current song ends"
                              IsChecked="{Binding Settings.RandomizeOnMusicEnd}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, after the current song finishes, a new random song will be selected from available songs. Creates automatic variety during extended listening."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,15"/>

                    <Separator Margin="0,15"/>

                    <!-- Music Status Tags -->
                    <TextBlock Text="Music Status Tags" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                    <TextBlock Text="Tag games based on music availability for easy filtering in Playnite" FontSize="11" Foreground="Gray" Margin="0,0,0,10"/>

                    <CheckBox Content="Auto-tag games on library update"
                              IsChecked="{Binding Settings.AutoTagOnLibraryUpdate}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, games will be automatically tagged with '[UPS] Has Music' or '[UPS] No Music' when you update your library. Use Playnite's filter to find games by tag."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10,0,5">
                        <Button Content="Scan &amp; Tag All Games"
                                Width="160"
                                Margin="0,0,10,0"
                                Command="{Binding ScanAndTagAllGamesCommand}"/>
                        <Button Content="Remove All Tags"
                                Width="140"
                                Command="{Binding RemoveAllMusicTagsCommand}"/>
                    </StackPanel>
                    <TextBlock Text="Manually scan your entire library and update music status tags. 'Remove All Tags' clears all UniPlaySong tags from your games."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,15"/>

                    <Separator Margin="0,15"/>

                    <!-- Troubleshooting -->
                    <TextBlock Text="Troubleshooting" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>

                    <CheckBox Content="Enable Debug Logging"
                              IsChecked="{Binding Settings.EnableDebugLogging}"
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, writes detailed debug information to UniPlaySong.log in the extension folder. Use this when troubleshooting issues. Disable for normal use to reduce log file size."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,15"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Live Effects Tab -->
        <TabItem Header="Live Effects">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel Margin="20">
                    <TextBlock Text="Live Audio Effects" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>
                    <TextBlock Text="Apply real-time audio effects during playback using NAudio processing. Requires enabling the master toggle below."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,20"/>

                    <!-- Master Toggle -->
                    <CheckBox Content="Enable Live Effects"
                              IsChecked="{Binding Settings.LiveEffectsEnabled}"
                              Margin="0,5"/>
                    <TextBlock Text="Enables NAudio-based audio processing with real-time effects. When toggled, the current song will restart from the beginning using the new audio player. Effects below only work when this is enabled."
                               FontSize="11"
                               Foreground="#FFA500"
                               FontWeight="SemiBold"
                               TextWrapping="Wrap"
                               Margin="20,0,0,20"/>

                    <Separator Margin="0,10"/>

                    <!-- High-Pass Filter Section -->
                    <TextBlock Text="High-Pass Filter" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>
                    <TextBlock Text="Removes low frequencies below the cutoff point. Useful for reducing rumble or bass."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <CheckBox Content="Enable High-Pass Filter"
                              IsChecked="{Binding Settings.HighPassEnabled}"
                              IsEnabled="{Binding Settings.LiveEffectsEnabled}"
                              Margin="0,5"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Cutoff Frequency: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.HighPassCutoff}"
                                   VerticalAlignment="Center"
                                   Width="45"/>
                        <TextBlock Text="Hz" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="20" Maximum="2000"
                                Value="{Binding Settings.HighPassCutoff}"
                                Width="180"
                                SmallChange="10"
                                LargeChange="100"
                                TickFrequency="200"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Frequencies below this value will be attenuated. Default: 80 Hz (subtle rumble removal)"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <Separator Margin="0,15"/>

                    <!-- Low-Pass Filter Section -->
                    <TextBlock Text="Low-Pass Filter" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>
                    <TextBlock Text="Removes high frequencies above the cutoff point. Creates a muffled or underwater effect."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <CheckBox Content="Enable Low-Pass Filter"
                              IsChecked="{Binding Settings.LowPassEnabled}"
                              IsEnabled="{Binding Settings.LiveEffectsEnabled}"
                              Margin="0,5"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Cutoff Frequency: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.LowPassCutoff}"
                                   VerticalAlignment="Center"
                                   Width="45"/>
                        <TextBlock Text="Hz" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="200" Maximum="20000"
                                Value="{Binding Settings.LowPassCutoff}"
                                Width="180"
                                SmallChange="100"
                                LargeChange="1000"
                                TickFrequency="2000"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Frequencies above this value will be attenuated. Default: 8000 Hz (subtle high-end rolloff)"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <Separator Margin="0,15"/>

                    <!-- Reverb Section -->
                    <TextBlock Text="Reverb" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>
                    <TextBlock Text="Adds spatial depth and ambience to the audio. Creates a sense of space or room. Based on libSoX/Audacity algorithm."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <CheckBox Content="Enable Reverb"
                              IsChecked="{Binding Settings.ReverbEnabled}"
                              IsEnabled="{Binding Settings.LiveEffectsEnabled}"
                              Margin="0,5"/>

                    <!-- Preset Dropdown -->
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Preset: " VerticalAlignment="Center" Width="120"/>
                        <ComboBox SelectedIndex="{Binding Settings.SelectedReverbPreset, Converter={StaticResource ReverbPresetConverter}}"
                                  Width="200">
                            <ComboBoxItem Content="Custom"/>
                            <!-- General Purpose (Audacity) -->
                            <ComboBoxItem Content="Acoustic"/>
                            <ComboBoxItem Content="Ambience"/>
                            <ComboBoxItem Content="Artificial"/>
                            <ComboBoxItem Content="Clean"/>
                            <ComboBoxItem Content="Modern"/>
                            <!-- Vocals (Audacity) -->
                            <ComboBoxItem Content="Vocal I"/>
                            <ComboBoxItem Content="Vocal II"/>
                            <ComboBoxItem Content="Dance Vocal"/>
                            <ComboBoxItem Content="Modern Vocal"/>
                            <ComboBoxItem Content="Voice Tail"/>
                            <!-- Room Sizes (Audacity) -->
                            <ComboBoxItem Content="Bathroom"/>
                            <ComboBoxItem Content="Small Room Bright"/>
                            <ComboBoxItem Content="Small Room Dark"/>
                            <ComboBoxItem Content="Medium Room"/>
                            <ComboBoxItem Content="Large Room"/>
                            <ComboBoxItem Content="Church Hall"/>
                            <ComboBoxItem Content="Cathedral"/>
                            <ComboBoxItem Content="Big Cave"/>
                            <!-- Living/Entertainment (UniPlaySong) -->
                            <ComboBoxItem Content="Living Room"/>
                            <ComboBoxItem Content="Home Theater"/>
                            <ComboBoxItem Content="Late Night TV"/>
                            <ComboBoxItem Content="Lounge/Cafe"/>
                            <ComboBoxItem Content="Jazz Club"/>
                            <ComboBoxItem Content="Night Club"/>
                            <ComboBoxItem Content="Concert Hall"/>
                        </ComboBox>
                    </StackPanel>
                    <TextBlock Text="Audacity-compatible presets plus UniPlaySong environments (Living Room, Home Theater, etc.). Adjusting sliders sets preset to 'Custom'."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Room Size -->
                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Room Size: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbRoomSize}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100"
                                Value="{Binding Settings.ReverbRoomSize}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Size of the virtual room. Small (0%) = tight/short reverb, Large (100%) = cathedral-like. Default: 75%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Reverberance (Audacity parameter) -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Reverberance: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbReverberance}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100"
                                Value="{Binding Settings.ReverbReverberance}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Length of reverb tail. Higher = longer, more 'live' reverb. Key for pronounced effects. Default: 50%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Pre-Delay -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Pre-Delay: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbPreDelay}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="ms" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="200"
                                Value="{Binding Settings.ReverbPreDelay}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="20"
                                TickFrequency="20"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Delay before reverb starts. Creates sense of distance. 0ms = close, 100ms+ = distant/large space. Default: 10 ms"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Stereo Width -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Stereo Width: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbStereoWidth}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100"
                                Value="{Binding Settings.ReverbStereoWidth}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Stereo spread of reverb. 0% = mono reverb, 100% = full stereo. Default: 100%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Wet Gain (Reverb volume) -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Wet Gain: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbWetGain}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="dB" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="-20" Maximum="10"
                                Value="{Binding Settings.ReverbWetGain}"
                                Width="180"
                                SmallChange="1"
                                LargeChange="3"
                                TickFrequency="5"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Volume of the reverb effect. Positive values = more pronounced reverb. Range: -20 to +10 dB. Default: -6 dB"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Dry Gain (Original volume) -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Dry Gain: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbDryGain}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="dB" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="-20" Maximum="0"
                                Value="{Binding Settings.ReverbDryGain}"
                                Width="180"
                                SmallChange="1"
                                LargeChange="3"
                                TickFrequency="2"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Volume of the original (dry) signal. 0 dB = full, -20 dB = very quiet. Default: 0 dB"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Damping (HF absorption) -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Damping: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbDamping}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100"
                                Value="{Binding Settings.ReverbDamping}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="High-frequency absorption. Higher = more muffled/darker reverb tail. Default: 50%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Tone Low (Audacity parameter) -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Tone Low: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbToneLow}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100"
                                Value="{Binding Settings.ReverbToneLow}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Bass content of reverb. Lower = less boomy, tighter reverb. Default: 100%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- Tone High (Audacity parameter) -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Tone High: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbToneHigh}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="0" Maximum="100"
                                Value="{Binding Settings.ReverbToneHigh}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Treble content of reverb. Lower = darker, less bright reverb. Default: 100%"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,15"/>

                    <Separator Margin="0,10"/>

                    <!-- Makeup Gain Section -->
                    <TextBlock Text="Output Gain" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>
                    <TextBlock Text="Final gain stage applied after all effects. Use to compensate for volume changes."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <CheckBox Content="Enable Makeup Gain"
                              IsChecked="{Binding Settings.MakeupGainEnabled}"
                              IsEnabled="{Binding Settings.LiveEffectsEnabled}"
                              Margin="0,5"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Gain: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.MakeupGain}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <TextBlock Text="dB" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <Slider Minimum="-6" Maximum="12"
                                Value="{Binding Settings.MakeupGain}"
                                Width="180"
                                SmallChange="1"
                                LargeChange="3"
                                TickFrequency="3"
                                TickPlacement="BottomRight"/>
                    </StackPanel>
                    <TextBlock Text="Boost or cut output volume. Uses soft-knee limiting to prevent harsh clipping. Default: 0 dB"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,15"/>

                    <Separator Margin="0,10"/>

                    <!-- Effect Chain Order Section -->
                    <TextBlock Text="Effect Chain Order" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>
                    <TextBlock Text="Controls the order in which effects are applied. Default is High-Pass → Low-Pass → Reverb (recommended)."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10" IsEnabled="{Binding Settings.LiveEffectsEnabled}">
                        <TextBlock Text="Chain Order: " VerticalAlignment="Center" Width="120"/>
                        <ComboBox SelectedIndex="{Binding Settings.EffectChainPreset, Converter={StaticResource EffectChainPresetConverter}}"
                                  Width="220">
                            <ComboBoxItem Content="High-Pass → Low-Pass → Reverb (Recommended)"/>
                            <ComboBoxItem Content="Reverb → High-Pass → Low-Pass"/>
                            <ComboBoxItem Content="Low-Pass → High-Pass → Reverb"/>
                            <ComboBoxItem Content="Low-Pass → Reverb → High-Pass"/>
                            <ComboBoxItem Content="High-Pass → Reverb → Low-Pass"/>
                            <ComboBoxItem Content="Reverb → Low-Pass → High-Pass"/>
                        </ComboBox>
                    </StackPanel>
                    <TextBlock Text="Be careful: Reverb-first orderings can cause unusual or harsh sounds with certain filter settings."
                               FontSize="11"
                               Foreground="#FFA500"
                               FontWeight="SemiBold"
                               TextWrapping="Wrap"
                               Margin="20,5,0,15"/>

                    <Separator Margin="0,10"/>

                    <!-- Advanced Reverb Tuning Section -->
                    <TextBlock Text="Advanced Reverb Tuning" FontSize="14" FontWeight="SemiBold" Margin="0,15,0,10"/>
                    <TextBlock Text="Expert-level parameters that affect the reverb algorithm behavior. For audio engineers and enthusiasts."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <CheckBox Content="Enable Advanced Tuning"
                              IsChecked="{Binding Settings.AdvancedReverbTuningEnabled}"
                              IsEnabled="{Binding Settings.LiveEffectsEnabled}"
                              Margin="0,5"/>
                    <TextBlock Text="⚠️ WARNING: These settings can produce VERY LOUD output that may damage your hearing or speakers! Only enable if you understand the reverb algorithm. Use at your own risk."
                               FontSize="11"
                               Foreground="#FF4444"
                               FontWeight="Bold"
                               TextWrapping="Wrap"
                               Margin="20,0,0,15"/>

                    <!-- Wet Gain Multiplier -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.AdvancedReverbTuningEnabled}">
                        <TextBlock Text="Wet Multiplier: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbWetGainMultiplier, StringFormat='0.{0:D2}'}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <Slider Minimum="1" Maximum="25"
                                Value="{Binding Settings.ReverbWetGainMultiplier}"
                                Width="180"
                                SmallChange="1"
                                LargeChange="5"
                                TickFrequency="5"
                                TickPlacement="BottomRight"
                                Margin="10,0,0,0"/>
                    </StackPanel>
                    <TextBlock Text="Scales reverb intensity (0.01-0.25). Default: 0.03. Higher = more reverb but risk of distortion. Values &gt;0.15 can be VERY loud!"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- HF Damping Min -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.AdvancedReverbTuningEnabled}">
                        <TextBlock Text="HF Damp Min: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbHfDampingMin, StringFormat='0.{0:D2}'}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <Slider Minimum="10" Maximum="40"
                                Value="{Binding Settings.ReverbHfDampingMin}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"
                                Margin="10,0,0,0"/>
                    </StackPanel>
                    <TextBlock Text="Minimum damping at 0% setting (0.10-0.40). Default: 0.20. Lower = brighter reverb."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <!-- HF Damping Max -->
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.AdvancedReverbTuningEnabled}">
                        <TextBlock Text="HF Damp Max: " VerticalAlignment="Center" Width="120"/>
                        <TextBlock Text="{Binding Settings.ReverbHfDampingMax, StringFormat='0.{0:D2}'}"
                                   VerticalAlignment="Center"
                                   Width="35"/>
                        <Slider Minimum="30" Maximum="70"
                                Value="{Binding Settings.ReverbHfDampingMax}"
                                Width="180"
                                SmallChange="5"
                                LargeChange="10"
                                TickFrequency="10"
                                TickPlacement="BottomRight"
                                Margin="10,0,0,0"/>
                    </StackPanel>
                    <TextBlock Text="Maximum damping at 100% setting (0.30-0.70). Default: 0.50. Higher = darker reverb at max damping."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,15"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Default Music Tab -->
        <TabItem Header="Default Music">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel Margin="20">
                    <TextBlock Text="Default Music Settings" FontSize="18" FontWeight="Bold" Margin="0,0,0,20"/>
                    <TextBlock Text="Play fallback music when no game music is found" FontSize="11" Foreground="Gray" Margin="0,0,0,20"/>
                    
                    <CheckBox Content="Enable Default Music" 
                              IsChecked="{Binding Settings.EnableDefaultMusic}" 
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, plays default music when a selected game has no music files" 
                               FontSize="11" 
                               Foreground="Gray" 
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>
                    
                    <StackPanel Orientation="Horizontal" Margin="0,5">
                        <TextBlock Text="Default Music File: " VerticalAlignment="Center" Width="120"/>
                        <TextBox Text="{Binding Settings.DefaultMusicPath}" 
                                 Width="300" 
                                 Margin="0,0,10,0"
                                 IsReadOnly="True"/>
                        <Button Content="Browse..." 
                                Width="80"
                                Margin="0,0,5,0"
                                Command="{Binding BrowseForDefaultMusicFile}"/>
                        <Button Content="Download..." 
                                Width="90"
                                Command="{Binding DownloadDefaultMusic}"/>
                    </StackPanel>
                    <TextBlock Text="Select a music file (MP3, WAV, FLAC, etc.) to play when no game music is available" 
                               FontSize="11" 
                               Foreground="Gray" 
                               TextWrapping="Wrap"
                               Margin="20,0,0,5"/>
                    
                    <CheckBox Content="Suppress Playnite Background Music" 
                              IsChecked="{Binding Settings.SuppressPlayniteBackgroundMusic}" 
                              IsEnabled="{Binding Settings.IsSuppressNativeMusicEnabled}"
                              Margin="0,10"/>
                    <TextBlock Text="When enabled, suppresses Playnite's native background music in fullscreen mode. When unchecked, native music will play when no game music and no default music is available. This option is disabled when 'Use Native Music as Default' is enabled." 
                               FontSize="11" 
                               Foreground="Gray" 
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>
                    
                    <CheckBox Content="Use Playnite Native &quot;Default&quot; Theme Music" 
                              IsChecked="{Binding Settings.UseNativeMusicAsDefault}"
                              IsEnabled="{Binding Settings.IsUseNativeMusicAsDefaultEnabled}"
                              Margin="0,10"/>
                    <TextBlock Text="When enabled (and Default Music is enabled), uses Playnite's vanilla default theme background music instead of a custom default music file. This prevents the use of custom default music and relies on Playnite's built-in default theme music for consistency. Native music will not be suppressed in this case. This option is disabled when 'Suppress Native Music' is enabled." 
                               FontSize="11" 
                               Foreground="Gray" 
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Audio Normalization Tab -->
        <TabItem Header="Audio Normalization">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel Margin="20">
                    <TextBlock Text="Audio Normalization" FontSize="18" FontWeight="Bold" Margin="0,0,0,20"/>
                    <TextBlock Text="Bulk normalize audio files to consistent volume levels (EBU R128 standard). Normalization is performed on-demand using the action buttons below - it is NOT applied in real-time during playback." 
                               FontSize="11" 
                               Foreground="Gray" 
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>
                    
                    <TextBlock Text="Normalization requires processing each file twice (analysis + application), which can be CPU-intensive for large libraries. Use bulk operations below to normalize files when needed."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <!-- FFmpeg Path Setting -->
                    <TextBlock Text="FFmpeg Configuration" FontSize="14" FontWeight="SemiBold" Margin="0,10,0,10"/>
                    <StackPanel Orientation="Horizontal" Margin="0,5">
                        <TextBlock Text="FFmpeg Path: " VerticalAlignment="Center" Width="120"/>
                        <TextBox Text="{Binding Settings.FFmpegPath}"
                                 Width="300"
                                 Margin="0,0,10,0"
                                 IsReadOnly="False"/>
                        <Button Content="Browse..."
                                Width="80"
                                Command="{Binding BrowseForFFmpegFile}"/>
                    </StackPanel>
                    <TextBlock Text="FFmpeg is required for audio normalization, silence trimming, precise trim, and audio repair features. Download from ffmpeg.org if not installed."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,20"/>

                    <StackPanel>
                        <TextBlock Text="Normalization Settings" FontSize="14" FontWeight="SemiBold" Margin="0,20,0,10"/>
                        
                        <StackPanel Orientation="Horizontal" Margin="0,5">
                            <TextBlock Text="Target Loudness: " VerticalAlignment="Center" Width="150"/>
                            <TextBox Text="{Binding Settings.NormalizationTargetLoudness}" 
                                     Width="60" 
                                     Margin="0,0,10,0"/>
                            <TextBlock Text="LUFS (EBU R128: -16 LUFS)" 
                                       VerticalAlignment="Center" 
                                       FontSize="11" 
                                       Foreground="Gray"/>
                        </StackPanel>
                        <TextBlock Text="Target integrated loudness. Industry standard is -16 LUFS. Range: -30 to -10 LUFS" 
                                   FontSize="11" 
                                   Foreground="Gray" 
                                   TextWrapping="Wrap"
                                   Margin="20,0,0,5"/>

                        <StackPanel Orientation="Horizontal" Margin="0,5">
                            <TextBlock Text="True Peak Limit: " VerticalAlignment="Center" Width="150"/>
                            <TextBox Text="{Binding Settings.NormalizationTruePeak}" 
                                     Width="60" 
                                     Margin="0,0,10,0"/>
                            <TextBlock Text="dBTP (EBU R128: -1.5 dBTP)" 
                                       VerticalAlignment="Center" 
                                       FontSize="11" 
                                       Foreground="Gray"/>
                        </StackPanel>
                        <TextBlock Text="True peak limit to prevent clipping. Industry standard is -1.5 dBTP. Range: -3.0 to 0.0 dBTP" 
                                   FontSize="11" 
                                   Foreground="Gray" 
                                   TextWrapping="Wrap"
                                   Margin="20,0,0,5"/>

                        <StackPanel Orientation="Horizontal" Margin="0,5">
                            <TextBlock Text="Loudness Range: " VerticalAlignment="Center" Width="150"/>
                            <TextBox Text="{Binding Settings.NormalizationLoudnessRange}" 
                                     Width="60" 
                                     Margin="0,0,10,0"/>
                            <TextBlock Text="LU (EBU R128: 11 LU)" 
                                       VerticalAlignment="Center" 
                                       FontSize="11" 
                                       Foreground="Gray"/>
                        </StackPanel>
                        <TextBlock Text="Loudness range target. Industry standard is 11 LU. Range: 1 to 20 LU" 
                                   FontSize="11" 
                                   Foreground="Gray" 
                                   TextWrapping="Wrap"
                                   Margin="20,0,0,5"/>

                        <StackPanel Orientation="Horizontal" Margin="0,5">
                            <TextBlock Text="Audio Codec: " VerticalAlignment="Center" Width="150"/>
                            <TextBox Text="{Binding Settings.NormalizationCodec}" 
                                     Width="120" 
                                     Margin="0,0,10,0"/>
                        </StackPanel>
                        <TextBlock Text="Audio codec for output files (default: libmp3lame for MP3)" 
                                   FontSize="11" 
                                   Foreground="Gray" 
                                   TextWrapping="Wrap"
                                   Margin="20,0,0,10"/>

                        <TextBlock Text="File Naming" FontSize="14" FontWeight="SemiBold" Margin="0,10,0,10"/>
                        <TextBlock Text="Normalized files are always created with a suffix (e.g., 'song-normalized.mp3'), preserving your original files. Original files are never modified or deleted." 
                                   FontSize="11" 
                                   Foreground="Gray" 
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,10"/>

                        <StackPanel Orientation="Horizontal" Margin="0,5">
                            <TextBlock Text="Normalization Suffix: " VerticalAlignment="Center" Width="150"/>
                            <TextBox Text="{Binding Settings.NormalizationSuffix}"
                                     Width="120"
                                     Margin="0,0,10,0"/>
                        </StackPanel>
                        <TextBlock Text="Suffix to append to normalized file names (default: '-normalized'). Example: 'song.mp3' becomes 'song-normalized.mp3'"
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"
                                   Margin="20,0,0,10"/>

                        <StackPanel Orientation="Horizontal" Margin="0,5">
                            <TextBlock Text="Silence Trim Suffix: " VerticalAlignment="Center" Width="150"/>
                            <TextBox Text="{Binding Settings.TrimSuffix}"
                                     Width="120"
                                     Margin="0,0,10,0"/>
                        </StackPanel>
                        <TextBlock Text="Suffix to append to silence-trimmed file names (default: '-trimmed'). Example: 'song.mp3' becomes 'song-trimmed.mp3'"
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"
                                   Margin="20,0,0,10"/>

                        <CheckBox Content="Skip Already Normalized Files" 
                                  IsChecked="{Binding Settings.SkipAlreadyNormalized}" 
                                  Margin="0,10"/>
                        <TextBlock Text="When enabled, files with the normalization suffix are automatically skipped during bulk operations. Useful when downloading new music." 
                                   FontSize="11" 
                                   Foreground="Gray" 
                                   TextWrapping="Wrap"
                                   Margin="20,0,0,10"/>

                        <CheckBox Content="Do not preserve originals (space saver)" 
                                  IsChecked="{Binding Settings.DoNotPreserveOriginals}" 
                                  Margin="0,10"/>
                        <TextBlock Text="When enabled, original files are normalized directly and replaced (no backup/preservation). Saves disk space but originals cannot be restored. When disabled, originals are moved to PreservedOriginals folder." 
                                   FontSize="11" 
                                   Foreground="#FFA500"
                                   FontWeight="SemiBold"
                                   TextWrapping="Wrap"
                                   Margin="20,0,0,20"/>

                        <Separator Margin="0,10"/>

                        <TextBlock Text="Bulk Actions" FontSize="14" FontWeight="SemiBold" Margin="0,10,0,10"/>

                        <StackPanel Orientation="Horizontal" Margin="0,5">
                            <Button Content="Normalize All Music Files"
                                    Width="220"
                                    Margin="0,0,10,0"
                                    Command="{Binding NormalizeAllMusicCommand}"/>
                            <TextBlock Text="Normalize all music in your library to consistent volume."
                                       VerticalAlignment="Center"
                                       FontSize="11"
                                       Foreground="Gray"
                                       TextWrapping="Wrap"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,10">
                            <Button Content="Trim Silence - All Files"
                                    Width="220"
                                    Margin="0,0,10,0"
                                    Command="{Binding TrimAllMusicCommand}"/>
                            <TextBlock Text="Remove leading silence from all music files."
                                       VerticalAlignment="Center"
                                       FontSize="11"
                                       Foreground="Gray"
                                       TextWrapping="Wrap"/>
                        </StackPanel>

                        <Separator Margin="0,15"/>

                        <TextBlock Text="Original File Management" FontSize="14" FontWeight="SemiBold" Margin="0,10,0,10"/>

                        <StackPanel Orientation="Horizontal" Margin="0,5">
                            <Button Content="Open Preserved Folder"
                                    Width="220"
                                    Margin="0,0,10,0"
                                    Command="{Binding OpenPreservedOriginalsFolderCommand}"/>
                            <TextBlock Text="Open the folder containing backup copies of original files."
                                       VerticalAlignment="Center"
                                       FontSize="11"
                                       Foreground="Gray"
                                       TextWrapping="Wrap"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,10">
                            <Button Content="Restore Original Files"
                                    Width="220"
                                    Margin="0,0,10,0"
                                    Command="{Binding RestoreNormalizedFilesCommand}"/>
                            <TextBlock Text="Restore originals and delete normalized/trimmed versions."
                                       VerticalAlignment="Center"
                                       FontSize="11"
                                       Foreground="Gray"
                                       TextWrapping="Wrap"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,10">
                            <Button Content="Delete Preserved Originals"
                                    Width="220"
                                    Margin="0,0,10,0"
                                    Command="{Binding DeletePreservedOriginalsCommand}"/>
                            <TextBlock Text="Permanently delete all preserved originals to free disk space."
                                       VerticalAlignment="Center"
                                       FontSize="11"
                                       Foreground="#FF6B6B"
                                       FontWeight="SemiBold"
                                       TextWrapping="Wrap"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Search Cache Tab -->
        <TabItem Header="Search Cache">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel Margin="20">
                    <TextBlock Text="Search Cache Settings" FontSize="18" FontWeight="Bold" Margin="0,0,0,20"/>
                    <TextBlock Text="Cache search results to speed up bulk downloads (50% faster on repeat runs)" 
                               FontSize="11" 
                               Foreground="Gray" 
                               Margin="0,0,0,20"/>
                    
                    <CheckBox Content="Enable Search Result Caching" 
                              IsChecked="{Binding Settings.EnableSearchCache}" 
                              Margin="0,5"/>
                    <TextBlock Text="When enabled, caches search results from KHInsider and YouTube to avoid redundant searches. Cached results expire after the specified duration." 
                               FontSize="11" 
                               Foreground="Gray" 
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>
                    
                    <StackPanel Orientation="Horizontal" Margin="0,5" IsEnabled="{Binding Settings.EnableSearchCache}">
                        <TextBlock Text="Cache Duration (days): " VerticalAlignment="Center" Width="150"/>
                        <TextBox Text="{Binding Settings.SearchCacheDurationDays}" 
                                 Width="60" 
                                 Margin="0,0,10,0"/>
                        <TextBlock Text="(1-30 days)" 
                                   VerticalAlignment="Center" 
                                   FontSize="11" 
                                   Foreground="Gray"/>
                    </StackPanel>
                    <TextBlock Text="How long to keep cached search results before they expire. Longer duration = fewer searches but may miss new uploads." 
                               FontSize="11" 
                               Foreground="Gray" 
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>
                    
                    <StackPanel Orientation="Horizontal" Margin="0,10">
                        <Button Content="Clear Search Cache" 
                                Width="150"
                                Command="{Binding ClearSearchCache}"/>
                        <TextBlock Text="{Binding CacheStatsText}" 
                                   VerticalAlignment="Center" 
                                   Margin="15,0,0,0"
                                   FontSize="11" 
                                   Foreground="Gray"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Downloads Tab -->
        <TabItem Header="Downloads">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel Margin="20">
                    <TextBlock Text="YouTube Download Settings" FontSize="18" FontWeight="Bold" Margin="0,0,0,20"/>
                    <TextBlock Text="Required for downloading music from YouTube" FontSize="11" Foreground="Gray" Margin="0,0,0,20"/>
                    
                    <StackPanel Orientation="Horizontal" Margin="0,5">
                        <TextBlock Text="yt-dlp Path: " VerticalAlignment="Center" Width="120"/>
                        <TextBox Text="{Binding Settings.YtDlpPath}" 
                                 Width="300" 
                                 Margin="0,0,10,0"
                                 IsReadOnly="False"/>
                        <Button Content="Browse..." 
                                Width="80"
                                Command="{Binding BrowseForYtDlpFile}"/>
                    </StackPanel>

                    <Separator Margin="0,10"/>
                    
                    <CheckBox Content="Use cookies from browser (Firefox)"
                              IsChecked="{Binding Settings.UseFirefoxCookies}"
                              Margin="0,10,0,5"/>
                    <TextBlock Text="When enabled, uses Firefox cookies for YouTube downloads. This helps bypass bot detection and improves download reliability. Make sure Firefox is installed and you're logged into YouTube in Firefox."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <Separator Margin="0,15"/>

                    <TextBlock Text="Post-Download Processing" FontSize="14" FontWeight="SemiBold" Margin="0,10,0,10"/>

                    <CheckBox Content="Automatically normalize downloaded music"
                              IsChecked="{Binding Settings.AutoNormalizeAfterDownload}"
                              Margin="0,10,0,5"/>
                    <TextBlock Text="When enabled, music files will be automatically normalized to EBU R128 standard after downloading. Uses the normalization settings configured in the Audio Normalization tab. Requires FFmpeg."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <Separator Margin="0,15"/>

                    <TextBlock Text="Auto-Download on Library Update" FontSize="14" FontWeight="SemiBold" Margin="0,10,0,10"/>

                    <CheckBox Content="Automatically download music for new games"
                              IsChecked="{Binding Settings.AutoDownloadOnLibraryUpdate}"
                              Margin="0,10,0,5"/>
                    <TextBlock Text="When enabled, music will be automatically downloaded for newly added games when your library is updated. Uses intelligent album and song selection to find the best match (title/main theme preferred). Only 1 song per game is downloaded. Requires yt-dlp and FFmpeg to be configured."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>

                    <Separator Margin="0,15"/>

                    <TextBlock Text="Bulk Download" FontSize="14" FontWeight="SemiBold" Margin="0,10,0,10"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10">
                        <Button Content="Download Music for All Games"
                                Width="220"
                                Margin="0,0,10,0"
                                Command="{Binding DownloadMusicForAllGamesCommand}"/>
                        <TextBlock Text="Download music for all games that don't have any yet."
                                   VerticalAlignment="Center"
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                    <TextBlock Text="Use this to populate music for your existing game library. Shows progress and can be cancelled."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="20,0,0,10"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Migration Tab -->
        <TabItem Header="Migration">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel Margin="20">
                    <TextBlock Text="Music Migration" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>
                    <TextBlock Text="Transfer music files between PlayniteSound and UniPlaySong extensions."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>

                    <TextBlock Text="Note: Only audio files will be migrated. Metadata files (.json) are not transferred. Files are copied, not moved - originals remain in place."
                               FontSize="11"
                               Foreground="#FFA500"
                               FontWeight="SemiBold"
                               TextWrapping="Wrap"
                               Margin="0,0,0,20"/>

                    <!-- Migration Summary -->
                    <Border Background="#2D2D2D" CornerRadius="4" Padding="15" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Current Status" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="PlayniteSound" FontWeight="SemiBold" Margin="0,0,0,5"/>
                                    <TextBlock Text="{Binding MigrationPlayniteSoundStatus}"
                                               FontSize="11"
                                               Foreground="Gray"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="UniPlaySong" FontWeight="SemiBold" Margin="0,0,0,5"/>
                                    <TextBlock Text="{Binding MigrationUniPlaySongStatus}"
                                               FontSize="11"
                                               Foreground="Gray"/>
                                </StackPanel>
                            </Grid>
                            <Button Content="Refresh Status"
                                    HorizontalAlignment="Left"
                                    Margin="0,10,0,0"
                                    Padding="10,5"
                                    Command="{Binding RefreshMigrationStatusCommand}"/>
                        </StackPanel>
                    </Border>

                    <Separator Margin="0,0,0,20"/>

                    <!-- Import from PlayniteSound -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock Text="Import from PlayniteSound" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock Text="Copy music files from PlayniteSound to UniPlaySong. Use this if you're switching from PlayniteSound to UniPlaySong."
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,10"/>
                        <Button Content="Import from PlayniteSound"
                                Command="{Binding MigrateFromPlayniteSoundCommand}"
                                Padding="15,8"
                                HorizontalAlignment="Left"/>
                    </StackPanel>

                    <Separator Margin="0,0,0,20"/>

                    <!-- Import from PlayniteSound & Delete -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock Text="Import from PlayniteSound &amp; Delete" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock Text="Import all music from PlayniteSound to UniPlaySong, then DELETE the original PlayniteSound files. Use this for a clean migration when you no longer need PlayniteSound."
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,5"/>
                        <TextBlock Text="WARNING: Original PlayniteSound music files will be permanently deleted after import!"
                                   FontSize="11"
                                   Foreground="#FF6666"
                                   FontWeight="SemiBold"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,10"/>
                        <Button Content="Import &amp; Delete PlayniteSound Music"
                                Command="{Binding MigrateFromPlayniteSoundAndDeleteCommand}"
                                Padding="15,8"
                                HorizontalAlignment="Left"
                                Background="#664422"
                                Foreground="White"/>
                    </StackPanel>

                    <Separator Margin="0,0,0,20"/>

                    <!-- Export to PlayniteSound -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock Text="Export to PlayniteSound" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock Text="Copy music files from UniPlaySong to PlayniteSound. Use this if you want to share your music library with PlayniteSound users or switch back."
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,10"/>
                        <Button Content="Export to PlayniteSound"
                                Command="{Binding MigrateToPlayniteSoundCommand}"
                                Padding="15,8"
                                HorizontalAlignment="Left"/>
                    </StackPanel>

                    <Separator Margin="0,0,0,20"/>

                    <!-- Directory Info -->
                    <StackPanel>
                        <TextBlock Text="Directory Locations" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="0,0,0,5">
                            <Run FontWeight="SemiBold">PlayniteSound:</Run>
                            <Run Text=" %APPDATA%\Playnite\ExtraMetadata\Games\{GameId}\Music Files\"/>
                        </TextBlock>
                        <TextBlock FontSize="11" Foreground="Gray" TextWrapping="Wrap">
                            <Run FontWeight="SemiBold">UniPlaySong:</Run>
                            <Run Text=" %APPDATA%\Playnite\ExtraMetadata\UniPlaySong\Games\{GameId}\"/>
                        </TextBlock>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Cleanup Tab -->
        <TabItem Header="Cleanup">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel Margin="20">
                    <TextBlock Text="Cleanup &amp; Reset" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>
                    <TextBlock Text="Reset UniPlaySong settings and remove all downloaded content."
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,0,0,20"/>

                    <!-- Warning Banner -->
                    <Border Background="#4A1A1A" BorderBrush="#FF4444" BorderThickness="1" CornerRadius="4" Padding="15" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="WARNING: These actions cannot be undone!"
                                       FontSize="14"
                                       FontWeight="Bold"
                                       Foreground="#FF6666"
                                       Margin="0,0,0,5"/>
                            <TextBlock Text="Factory Reset will permanently delete all downloaded music files, preserved originals, and reset all settings to their defaults. Make sure you have backups if needed."
                                       FontSize="11"
                                       Foreground="#FFAAAA"
                                       TextWrapping="Wrap"/>
                        </StackPanel>
                    </Border>

                    <!-- Current Storage Info -->
                    <Border Background="#2D2D2D" CornerRadius="4" Padding="15" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Current Storage Usage" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                            <TextBlock Text="{Binding CleanupStorageInfo}"
                                       FontSize="11"
                                       Foreground="Gray"
                                       TextWrapping="Wrap"/>
                            <Button Content="Refresh"
                                    HorizontalAlignment="Left"
                                    Margin="0,10,0,0"
                                    Padding="10,5"
                                    Command="{Binding RefreshCleanupStorageInfoCommand}"/>
                        </StackPanel>
                    </Border>

                    <Separator Margin="0,0,0,20"/>

                    <!-- Delete All Music -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock Text="Delete All Music" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock Text="Removes all downloaded music files and game folders. Settings will be preserved."
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,10"/>
                        <Button Content="Delete All Music Files"
                                Command="{Binding DeleteAllMusicCommand}"
                                Padding="15,8"
                                HorizontalAlignment="Left"
                                Background="#882222"
                                Foreground="White"/>
                    </StackPanel>

                    <Separator Margin="0,0,0,20"/>

                    <!-- Delete Long Songs -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock Text="Delete Long Songs" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock Text="Scans your music library and deletes songs longer than 10 minutes. Useful for removing accidentally downloaded full albums, podcasts, or corrupted files that break bulk operations."
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,10"/>
                        <Button Content="Delete Songs &gt; 10 Minutes"
                                Command="{Binding DeleteLongSongsCommand}"
                                Padding="15,8"
                                HorizontalAlignment="Left"
                                Background="#664422"
                                Foreground="White"/>
                    </StackPanel>

                    <Separator Margin="0,0,0,20"/>

                    <!-- Reset Settings Only -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock Text="Reset Settings Only" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock Text="Resets all settings to their default values. Music files will be preserved."
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,10"/>
                        <Button Content="Reset Settings to Defaults"
                                Command="{Binding ResetSettingsCommand}"
                                Padding="15,8"
                                HorizontalAlignment="Left"/>
                    </StackPanel>

                    <Separator Margin="0,0,0,20"/>

                    <!-- Factory Reset -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock Text="Factory Reset" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock Text="Completely resets UniPlaySong to its initial state. This will:"
                                   FontSize="11"
                                   Foreground="Gray"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,5"/>
                        <TextBlock FontSize="11" Foreground="Gray" Margin="10,0,0,10">
                            <Run Text="- Delete all downloaded music files"/>
                            <LineBreak/>
                            <Run Text="- Delete all preserved original files"/>
                            <LineBreak/>
                            <Run Text="- Remove all game music folders"/>
                            <LineBreak/>
                            <Run Text="- Clear the search cache"/>
                            <LineBreak/>
                            <Run Text="- Reset all settings to defaults"/>
                        </TextBlock>
                        <Button Content="Factory Reset"
                                Command="{Binding FactoryResetCommand}"
                                Padding="15,8"
                                HorizontalAlignment="Left"
                                Background="#AA2222"
                                Foreground="White"
                                FontWeight="Bold"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </TabItem>
    </TabControl>
</UserControl>